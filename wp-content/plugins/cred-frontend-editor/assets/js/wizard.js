var cred_cred_wizard=function(a,b,c,d){var e=null,f=null;return f=f||{submithandler:function(b){b.preventDefault();var c=a(this),g=a("#post_ID").val();return d.doCheck()&&a.ajax({url:f.form_controller_url+"/updateFormField",data:"form_id="+g+"&field=wizard"+"&value="+e.completed_step,type:"post",success:function(a){return c.unbind("submit",f.submithandler),c.submit(),!0}}),!1},serialize:function(b){var c,e,f=d.getCodeMirrorContents();c=a(b).serializeArray();for(e=0;e<c.length;++e)f[c[e].name]&&(c[e].value=f[c[e].name]);return a.param(c)}},e=e||{step:1,prevstep:0,completed_step:0,steps:5,step_1:{title:b.step_1_title,completed:!1,execute:function(){a("#post-body-content").children(":not(.cred-not-hide)").hide(),a("#titlediv").show(),a("#cred-wizard-button-prev").hide(),e.step_1.completed?(e.step_1.completed=!0,e.completed_step=1,a("#cred-wizard-button-next").removeAttr("disabled")):(a("#cred-wizard-button-next").attr("disabled","disabled"),a("#title").unbind("keyup").bind("keyup paste",function(){e.step_1.completed=!0,e.completed_step=1,a("#cred-wizard-button-next").removeAttr("disabled"),a("#title").unbind("keyup")}),a(".cred-progress-bar-inner").css("width","20%"))}},step_2:{title:b.step_2_title,completed:!1,execute:function(b){a("#post-body-content").children(":not(.cred-not-hide)").hide(),a("#credformtypediv").show(),a("#cred-wizard-button-prev").show(),e.step_2.completed?(e.step_2.completed=!0,e.completed_step=2,a("#cred-wizard-button-next").removeAttr("disabled")):(a("#cred-wizard-button-next").attr("disabled","disabled"),a('select[name="cred_form_type"]').bind("change",function(){e.step_2.completed=!0,e.completed_step=2,a("#cred-wizard-button-next").removeAttr("disabled")}),a(".cred-progress-bar-inner").css("width","40%"))}},step_3:{title:b.step_3_title,completed:!1,execute:function(b){a("#post-body-content").children(":not(.cred-not-hide)").hide(),a("#credposttypediv").show(),a("#cred-wizard-button-prev").show(),e.step_3.completed?(e.step_3.completed=!0,e.completed_step=3,a("#cred-wizard-button-next").removeAttr("disabled")):(a("#cred-wizard-button-next").attr("disabled","disabled"),a('select[name="cred_post_type"]').unbind("change").bind("change",function(){e.step_3.completed=!0,e.completed_step=3,a("#cred-wizard-button-next").removeAttr("disabled")}),a(".cred-progress-bar-inner").css("width","60%"))}},step_4:{title:b.step_4_title,completed:!1,execute:function(b){a("#post-body-content").children(":not(.cred-not-hide)").hide(),a("#postdivrichwrap").show(),a("#cred-wizard-button-prev").show();if(!e.step_4.completed){a("#cred-wizard-button-next").attr("disabled","disabled"),a("#content").bind("keyup paste",function(){e.completed_step=4,e.step_4.completed=!0,a("#cred-wizard-button-next").removeAttr("disabled")}),a(".cred-progress-bar-inner").css("width","80%");var c=setInterval(function(){if(!e.step_4.completed){var b=d.getCodeMirrorContents();b=a.trim(b.content),""!=b&&(clearInterval(c),e.completed_step=4,e.step_4.completed=!0,a("#cred-wizard-button-next").removeAttr("disabled"))}else clearInterval(c)},200)}else e.step_4.completed=!0,e.completed_step=4,a("#cred-wizard-button-next").removeAttr("disabled")}},step_5:{title:b.step_5_title,completed:!1,execute:function(b){a("#post-body-content").children(":not(.cred-not-hide)").hide(),a("#crednotificationdiv").show(),a("#cred-wizard-button-prev").show(),a("#cred-wizard-button-next").removeAttr("disabled"),e.completed_step=5,e.step_5.completed=!0,e.step_5.completed?(e.step_5.completed=!0,e.completed_step=5,a("#cred-wizard-button-next").removeAttr("disabled")):(a("#cred_mail_to").unbind("keyup paste").bind("keyup paste",function(){e.completed_step=5,e.step_5.completed=!0,a("#cred-wizard-button-next").removeAttr("disabled")}),a(".cred-progress-bar-inner").css("width","100%"))}},prevStep:function(){e.goToStep(e.step-1)},nextStep:function(){if(f.newform&&e.step==1&&!e.step_2.completed){var b=a("#post_ID").val();d.doCheck()&&a.ajax({url:f.edit_url,data:f.serialize("#post"),type:"post",success:function(c){a.ajax({url:f.form_controller_url+"/updateFormField",data:"form_id="+b+"&field=wizard"+"&value="+e.completed_step,type:"post",success:function(a){document.location=f.edit_url+"?action=edit&post="+b}})}})}else if(d.doCheck()){var c=e.completed_step;e.completed_step==e.steps&&(c=-1),a.ajax({url:document.location,data:f.serialize("#post")+"&_cred_wizard="+c,type:"post",success:function(){}}),e.goToStep(e.step+1)}},goToStep:function(c){if(typeof c=="undefined")return;c=parseInt(c);if(c<=e.steps+1&&c>=1)e.step=c;else return;if(e.step==e.steps+1){e.finish();return}if(typeof e["step_"+e.step]!="undefined"&&typeof e["step_"+e.step].execute=="function"){e.step==e.steps?a("#cred-wizard-button-next").show().val(b.finish_text):a("#cred-wizard-button-next").show().val(b.next_text),e["step_"+e.step].execute();return}},start:function(){a("#post-body-content").append('<div class="cred-not-hide cred-wizard-buttons"> <input id="cred_wizard_quit_button" type="button" class="button" value="'+b.quit_wizard_text+'" /> <input type="button" id="cred-wizard-button-prev" class="button" value="'+b.prev_text+'" /> <input type="button" id="cred-wizard-button-next" class="button-primary" value="'+b.next_text+'" /></div>'),a("#post-body-content").prepend('<div class="cred-not-hide cred-progress"><div class="cred-progress-bar"><div class="cred-progress-bar-inner"></div></div></div>'),a("#cred-submit").hide(),a("#cred_add_forms_to_site_help").hide(),a("#post").submit(f.submithandler);var c=a('<span class="cred-progress-step">'+e.step_1.title+"</span>");c.insertBefore(".cred-progress-bar").css({left:"20%","margin-left":-c.width()+"px"});var d=a('<span class="cred-progress-step">'+e.step_2.title+"</span>");d.insertBefore(".cred-progress-bar").css({left:"40%","margin-left":-d.width()+"px"});var g=a('<span class="cred-progress-step">'+e.step_3.title+"</span>");g.insertBefore(".cred-progress-bar").css({left:"60%","margin-left":-g.width()+"px"});var h=a('<span class="cred-progress-step">'+e.step_4.title+"</span>");h.insertBefore(".cred-progress-bar").css({left:"80%","margin-left":-h.width()+"px"});var i=a('<span class="cred-progress-step">'+e.step_5.title+"</span>");i.insertBefore(".cred-progress-bar").css({left:"100%","margin-left":-i.width()+"px"}),a("#post-body-content").on("click","#cred_wizard_quit_button",function(){form_id=a("#post_ID").val(),a.msgbox(b.quit_wizard_confirm_text,{type:"confirm",buttons:[{type:"submit",value:b.quit_wizard_this_form},{type:"submit",value:b.quit_wizard_all_forms},{type:"cancel",value:b.cancel_text}]},function(c){c==b.quit_wizard_all_forms&&a.ajax({url:f.url,type:"POST",data:"cred_wizard=false",dataType:"html",success:function(){}}),c==b.quit_wizard_this_form&&a.ajax({url:f.form_controller_url+"/updateFormField",data:"form_id="+form_id+"&field=wizard"+"&value=-1",type:"post",success:function(){}}),(c==b.quit_wizard_all_forms||c==b.quit_wizard_this_form)&&a("#post").unbind("submit",f.submithandler),e.finish()})}),a("#post-body-content").on("click","#cred-wizard-button-next",function(){e.nextStep()}),a("#post-body-content").on("click","#cred-wizard-button-prev",function(){e.prevStep()});for(var j=1;j<=e.step;j++)typeof e["step_"+j]!="undefined"&&(e["step_"+j].completed=!0);e.completed_step=e.step,a(".cred-progress-bar-inner").css("width",100*e.step/e.steps+"%"),e.step<e.steps&&e.goToStep(e.step+1)},finish:function(){e.completed_step=-1,a("#post-body-content").children().show(),a("#cred-submit").show(),a("#cred_add_forms_to_site_help").show(),a("#post-body-content").children(".cred-not-hide").hide()},init:function(a,b,c,d,g){f.url=a,f.edit_url=b,f.form_controller_url=c,f.step=d,f.newform=g,f.step>=0&&(e.step=f.step,e.start())}},e}(jQuery,cred_cred_config,cred_cred_help,cred_cred)