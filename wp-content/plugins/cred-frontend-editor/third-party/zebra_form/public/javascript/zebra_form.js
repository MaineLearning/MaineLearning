/**
 *  MyZebra_Form (original is Zebra_Form)
 *
 *  Client-side validation for MyZebra_Form
 *
 *  Visit {@link http://stefangabos.ro/php-libraries/zebra-form/} for more information.
 *
 *  For more resources visit {@link http://stefangabos.ro/}
 *
 *  @author     Stefan Gabos <contact@stefangabos.ro>
 *  @version    2.8.5 (last revision: July 23, 2012)
 *  @copyright  (c) 2011 - 2012 Stefan Gabos
 *  @license    http://www.gnu.org/licenses/lgpl-3.0.txt GNU LESSER GENERAL PUBLIC LICENSE
 *  @package    MyZebra_Form
 */
/**
*
*   Edited, Augmented and Modified by Nikos M. (nikos.m@icanlocalize.com)
*
**/
 
/**
================================
Zebra Date Picker
=================================
**/

;(function(a){a.MyZebra_DatePicker=function(b,c){var d={always_show_clear:!1,always_visible:!1,days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],direction:0,disabled_dates:!1,first_day_of_week:1,format:"Y-m-d",inside:!0,lang_clear_date:"Clear",months:["January","February","March","April","May","June","July","August","September","October","November","December"],offset:[20,-5],pair:!1,readonly_element:!0,show_week_number:!1,start_date:!1,view:"days",weekend_days:[0,6],onSelect:null},e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I=this;I.settings={};var J=a(b),K=function(y){y||(I.settings=a.extend({},d,c)),I.settings.readonly_element&&J.attr("readonly","readonly");var E={days:["d","j"],months:["F","m","M","n","t"],years:["o","Y","y"]},F=!1,G=!1,K=!1;for(type in E)a.each(E[type],function(a,b){I.settings.format.indexOf(b)>-1&&(type=="days"?F=!0:type=="months"?G=!0:type=="years"&&(K=!0))});F&&G&&K?H=["years","months","days"]:!F&&G&&K?H=["years","months"]:!F&&!G&&K?H=["years"]:H=["years","months","days"],a.inArray(I.settings.view,H)==-1&&(I.settings.view=H[H.length-1]);var N=new Date,O=I.settings.reference_date?I.settings.reference_date:J.data("zdp_reference_date")?J.data("zdp_reference_date"):N,P,Q;z=undefined,A=undefined,p=O.getMonth(),m=N.getMonth(),q=O.getFullYear(),n=N.getFullYear(),r=O.getDate(),o=N.getDate();if(I.settings.direction===!0)z=O;else if(I.settings.direction===!1)A=O,D=A.getMonth(),C=A.getFullYear(),B=A.getDate();else if(!a.isArray(I.settings.direction)&&U(I.settings.direction)&&_(I.settings.direction)>0||a.isArray(I.settings.direction)&&(I.settings.direction[0]===!0||U(I.settings.direction[0])&&I.settings.direction[0]>0||(P=L(I.settings.direction[0])))&&(I.settings.direction[1]===!1||U(I.settings.direction[1])&&I.settings.direction[1]>=0||(Q=L(I.settings.direction[1]))))P?z=P:z=new Date(q,p,r+(a.isArray(I.settings.direction)?_(I.settings.direction[0]===!0?0:I.settings.direction[0]):_(I.settings.direction))),p=z.getMonth(),q=z.getFullYear(),r=z.getDate(),Q&&+Q>+z?A=Q:!Q&&I.settings.direction[1]!==!1&&a.isArray(I.settings.direction)&&(A=new Date(q,p,r+_(I.settings.direction[1]))),A&&(D=A.getMonth(),C=A.getFullYear(),B=A.getDate());else if(!a.isArray(I.settings.direction)&&U(I.settings.direction)&&_(I.settings.direction)<0||a.isArray(I.settings.direction)&&(I.settings.direction[0]===!1||U(I.settings.direction[0])&&I.settings.direction[0]<0)&&(U(I.settings.direction[1])&&I.settings.direction[1]>=0||(P=L(I.settings.direction[1]))))A=new Date(q,p,r+(a.isArray(I.settings.direction)?_(I.settings.direction[0]===!1?0:I.settings.direction[0]):_(I.settings.direction))),D=A.getMonth(),C=A.getFullYear(),B=A.getDate(),P&&+P<+A?z=P:!P&&a.isArray(I.settings.direction)&&(z=new Date(C,D,B-_(I.settings.direction[1]))),z&&(p=z.getMonth(),q=z.getFullYear(),r=z.getDate());if(z&&T(q,p,r)){while(T(q))z?q++:q--,p=0;while(T(q,p))z?p++:p--,p>11?(q++,p=0):p<0&&(q--,p=0),r=1;while(T(q,p,r))z?r++:r--;N=new Date(q,p,r),q=N.getFullYear(),p=N.getMonth(),r=N.getDate()}x=[],a.each(I.settings.disabled_dates,function(){var b=this.split(" ");for(var c=0;c<4;c++){b[c]||(b[c]="*"),b[c]=b[c].indexOf(",")>-1?b[c].split(","):new Array(b[c]);for(var d=0;d<b[c].length;d++)if(b[c][d].indexOf("-")>-1){var e=b[c][d].match(/^([0-9]+)\-([0-9]+)/);if(null!=e){for(var f=_(e[1]);f<=_(e[2]);f++)a.inArray(f,b[c])==-1&&b[c].push(f+"");b[c].splice(d,1)}}for(d=0;d<b[c].length;d++)b[c][d]=isNaN(_(b[c][d]))?b[c][d]:_(b[c][d])}x.push(b)});var R=L(J.val()||(I.settings.start_date?I.settings.start_date:""));R&&T(R.getFullYear(),R.getMonth(),R.getDate())&&J.val(""),ba(R);if(y)return;if(!I.settings.always_visible){var S='<button type="button" class="MyZebra_DatePicker_Icon'+(J.attr("disabled")=="disabled"?" MyZebra_DatePicker_Icon_Disabled":"")+'">Pick a date</button>';g=a(S),I.icon=g,(I.settings.readonly_element?g.add(J):g).bind("click",function(a){a.preventDefault(),J.attr("disabled")||(f.css("display")!="none"?I.hide():I.show())}),g.insertAfter(b)}var S='<div class="MyZebra_DatePicker"><table class="dp_header"><tr><td class="dp_previous">&laquo;</td><td class="dp_caption">&nbsp;</td><td class="dp_next">&raquo;</td></tr></table><table class="dp_daypicker"></table><table class="dp_monthpicker"></table><table class="dp_yearpicker"></table><table class="dp_footer"><tr><td>'+I.settings.lang_clear_date+"</td></tr>"+"</table>"+"</div>";f=a(S),I.datepicker=f,h=a("table.dp_header",f),i=a("table.dp_daypicker",f),j=a("table.dp_monthpicker",f),k=a("table.dp_yearpicker",f),l=a("table.dp_footer",f),I.settings.always_visible?J.attr("disabled")||(I.settings.always_visible.append(f),I.show()):a("body").append(f),f.delegate("td:not(.dp_disabled, .dp_weekend_disabled, .dp_not_in_month, .dp_blocked, .dp_week_number)","mouseover",function(){a(this).addClass("dp_hover")}).delegate("td:not(.dp_disabled, .dp_weekend_disabled, .dp_not_in_month, .dp_blocked, .dp_week_number)","mouseout",function(){a(this).removeClass("dp_hover")}),M(a("td",h)),a(".dp_previous",h).bind("click",function(){a(this).hasClass("dp_blocked")||(e=="months"?t--:e=="years"?t-=12:--s<0&&(s=11,t--),W())}),a(".dp_caption",h).bind("click",function(){e=="days"?e=a.inArray("months",H)>-1?"months":a.inArray("years",H)>-1?"years":"days":e=="months"?e=a.inArray("years",H)>-1?"years":a.inArray("days",H)>-1?"days":"months":e=a.inArray("days",H)>-1?"days":a.inArray("months",H)>-1?"months":"years",W()}),a(".dp_next",h).bind("click",function(){a(this).hasClass("dp_blocked")||(e=="months"?t++:e=="years"?t+=12:++s==12&&(s=0,t++),W())}),i.delegate("td:not(.dp_disabled, .dp_weekend_disabled, .dp_not_in_month, .dp_week_number)","click",function(){X(t,s,_(a(this).html()),"days",a(this))}),j.delegate("td:not(.dp_disabled)","click",function(){var b=a(this).attr("class").match(/dp\_month\_([0-9]+)/);s=_(b[1]),a.inArray("days",H)==-1?X(t,s,1,"months",a(this)):(e="days",I.settings.always_visible&&J.val(""),W())}),k.delegate("td:not(.dp_disabled)","click",function(){t=_(a(this).html()),a.inArray("months",H)==-1?X(t,1,1,"years",a(this)):(e="months",I.settings.always_visible&&J.val(""),W())}),a("td",l).bind("click",function(a){a.preventDefault(),J.val(""),I.settings.always_visible||(u=null,v=null,w=null,s=null,t=null,l.css("display","none")),I.hide()}),I.settings.always_visible||a(document).bind({mousedown:I._mousedown,keyup:I._keyup}),W()};I.hide=function(){I.settings.always_visible||(S("hide"),f.css("display","none"))},I.show=function(){e=I.settings.view;var b=L(J.val()||(I.settings.start_date?I.settings.start_date:""));b?(v=b.getMonth(),s=b.getMonth(),w=b.getFullYear(),t=b.getFullYear(),u=b.getDate(),T(w,v,u)&&(J.val(""),s=p,t=q)):(s=p,t=q),W();if(!I.settings.always_visible){var c=f.outerWidth(),d=f.outerHeight(),h=g.offset().left+I.settings.offset[0],i=g.offset().top-d+I.settings.offset[1],j=a(window).width(),k=a(window).height(),l=a(window).scrollTop(),m=a(window).scrollLeft();h+c>m+j&&(h=m+j-c),h<m&&(h=m),i+d>l+k&&(i=l+k-d),i<l&&(i=l),f.css({left:h,top:i}),f.fadeIn(a.browser.msie&&a.browser.version.match(/^[6-8]/)?0:150,"linear"),S()}else f.css("display","block")},I.update=function(b){I.original_direction&&(I.original_direction=I.direction),I.settings=a.extend(I.settings,b),K(!0)};var L=function(b){b+="";if(a.trim(b)!=""){var c=N(I.settings.format.replace(/\s/g,"")),d=["d","D","j","l","N","S","w","F","m","M","n","Y","y"],e=new Array,f=new Array;for(var g=0;g<d.length;g++)(position=c.indexOf(d[g]))>-1&&e.push({character:d[g],position:position});e.sort(function(a,b){return a.position-b.position}),a.each(e,function(a,b){switch(b.character){case"d":f.push("0[1-9]|[12][0-9]|3[01]");break;case"D":f.push("[a-z]{3}");break;case"j":f.push("[1-9]|[12][0-9]|3[01]");break;case"l":f.push("[a-z]+");break;case"N":f.push("[1-7]");break;case"S":f.push("st|nd|rd|th");break;case"w":f.push("[0-6]");break;case"F":f.push("[a-z]+");break;case"m":f.push("0[1-9]|1[012]+");break;case"M":f.push("[a-z]{3}");break;case"n":f.push("[1-9]|1[012]");break;case"Y":f.push("[0-9]{4}");break;case"y":f.push("[0-9]{2}")}});if(f.length){e.reverse(),a.each(e,function(a,b){c=c.replace(b.character,"("+f[f.length-a-1]+")")}),f=new RegExp("^"+c+"$","ig");if(segments=f.exec(b.replace(/\s/g,""))){var h,i,j,k=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l=["January","February","March","April","May","June","July","August","September","October","November","December"],m,n=!0;e.reverse(),a.each(e,function(b,c){if(!n)return!0;switch(c.character){case"m":case"n":i=_(segments[b+1]);break;case"d":case"j":h=_(segments[b+1]);break;case"D":case"l":case"F":case"M":c.character=="D"||c.character=="l"?m=I.settings.days:m=I.settings.months,n=!1,a.each(m,function(a,d){if(n)return!0;if(segments[b+1].toLowerCase()==d.substring(0,c.character=="D"||c.character=="M"?3:d.length).toLowerCase()){switch(c.character){case"D":segments[b+1]=k[a].substring(0,3);break;case"l":segments[b+1]=k[a];break;case"F":segments[b+1]=l[a],i=a+1;break;case"M":segments[b+1]=l[a].substring(0,3),i=a+1}n=!0}});break;case"Y":j=_(segments[b+1]);break;case"y":j="19"+_(segments[b+1])}});if(n){var o=new Date(j,(i||1)-1,h||1);if(o.getFullYear()==j&&o.getDate()==(h||1)&&o.getMonth()==(i||1)-1)return o}}}return!1}},M=function(b){a.browser.mozilla?b.css("MozUserSelect","none"):a.browser.msie?b.bind("selectstart",function(){return!1}):b.mousedown(function(){return!1})},N=function(a){return a.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},O=function(a){var b="",c=a.getDate(),d=a.getDay(),e=I.settings.days[d],f=a.getMonth()+1,g=I.settings.months[f-1],h=a.getFullYear()+"";for(var i=0;i<I.settings.format.length;i++){var j=I.settings.format.charAt(i);switch(j){case"y":h=h.substr(2);case"Y":b+=h;break;case"m":f=Z(f,2);case"n":b+=f;break;case"M":g=g.substr(0,3);case"F":b+=g;break;case"d":c=Z(c,2);case"j":b+=c;break;case"D":e=e.substr(0,3);case"l":b+=e;break;case"N":d++;case"w":b+=d;break;case"S":c%10==1&&c!="11"?b+="st":c%10==2&&c!="12"?b+="nd":c%10==3&&c!="13"?b+="rd":b+="th";break;default:b+=j}}return b},P=function(){var b=(new Date(t,s+1,0)).getDate(),c=(new Date(t,s,1)).getDay(),d=(new Date(t,s,0)).getDate(),e=c-I.settings.first_day_of_week;e=e<0?7+e:e,V(I.settings.months[s]+", "+t);var f="<tr>";I.settings.show_week_number&&(f+="<th>"+I.settings.show_week_number+"</th>");for(var g=0;g<7;g++)f+="<th>"+I.settings.days[(I.settings.first_day_of_week+g)%7].substr(0,2)+"</th>";f+="</tr><tr>";for(var g=0;g<42;g++){g>0&&g%7==0&&(f+="</tr><tr>");if(g%7==0&&I.settings.show_week_number){var h=new Date(t,s,g-e+1),j=new Date(t,0,1),k=j.getDay()-I.settings.first_day_of_week,l=Math.floor((h.getTime()-j.getTime()-(h.getTimezoneOffset()-j.getTimezoneOffset())*6e4)/864e5)+1,p;k=k>=0?k:k+7;if(k<4){p=Math.floor((l+k-1)/7)+1;if(p+1>52){var q=new Date(h.getFullYear()+1,0,1),r=nYear.getDay()-I.settings.first_day_of_week;r=r>=0?r:r+7,p=r<4?1:53}}else p=Math.floor((l+k-1)/7);f+='<td class="dp_week_number">'+p+"</td>"}var x=g-e+1;if(g<e)f+='<td class="dp_not_in_month">'+(d-e+g+1)+"</td>";else if(x>b)f+='<td class="dp_not_in_month">'+(x-b)+"</td>";else{var y=(I.settings.first_day_of_week+g)%7,z="";T(t,s,x)?(a.inArray(y,I.settings.weekend_days)>-1?z="dp_weekend_disabled":z+=" dp_disabled",s==m&&t==n&&o==x&&(z+=" dp_disabled_current")):(a.inArray(y,I.settings.weekend_days)>-1&&(z="dp_weekend"),s==v&&t==w&&u==x&&(z+=" dp_selected"),s==m&&t==n&&o==x&&(z+=" dp_current")),f+="<td"+(z!=""?' class="'+a.trim(z)+'"':"")+">"+Z(x,2)+"</td>"}}f+="</tr>",i.html(a(f)),I.settings.always_visible&&(E=a("td:not(.dp_disabled, .dp_weekend_disabled, .dp_not_in_month, .dp_blocked, .dp_week_number)",i)),i.css("display","")},Q=function(){V(t);var b="<tr>";for(var c=0;c<12;c++){c>0&&c%3==0&&(b+="</tr><tr>");var d="dp_month_"+c;T(t,c)?d+=" dp_disabled":v!==!1&&v==c?d+=" dp_selected":m==c&&n==t&&(d+=" dp_current"),b+='<td class="'+a.trim(d)+'">'+I.settings.months[c].substr(0,3)+"</td>"}b+="</tr>",j.html(a(b)),I.settings.always_visible&&(F=a("td:not(.dp_disabled)",j)),j.css("display","")},R=function(){V(t-7+" - "+(t+4));var b="<tr>";for(var c=0;c<12;c++){c>0&&c%3==0&&(b+="</tr><tr>");var d="";T(t-7+c)?d+=" dp_disabled":w&&w==t-7+c?d+=" dp_selected":n==t-7+c&&(d+=" dp_current"),b+="<td"+(a.trim(d)!=""?' class="'+a.trim(d)+'"':"")+">"+(t-7+c)+"</td>"}b+="</tr>",k.html(a(b)),I.settings.always_visible&&(G=a("td:not(.dp_disabled)",k)),k.css("display","")},S=function(b){if(a.browser.msie&&a.browser.version.match(/^6/)){if(!y){var c=_(f.css("zIndex"))-1;y=jQuery("<iframe>",{src:'javascript:document.write("")',scrolling:"no",frameborder:0,allowtransparency:"true",css:{zIndex:c,position:"absolute",top:-1e3,left:-1e3,width:f.outerWidth(),height:f.outerHeight(),filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)",display:"none"}}),a("body").append(y)}switch(b){case"hide":y.css("display","none");break;default:var d=f.offset();y.css({top:d.top,left:d.left,display:"block"})}}},T=function(b,c,d){if(!!a.isArray(I.settings.direction)||_(I.settings.direction)!==0){var e=_(Y(b,typeof c!="undefined"?Z(c,2):"",typeof d!="undefined"?Z(d,2):"")),f=(e+"").length;if(f==8&&(typeof z!="undefined"&&e<_(Y(q,Z(p,2),Z(r,2)))||typeof A!="undefined"&&e>_(Y(C,Z(D,2),Z(B,2)))))return!0;if(f==6&&(typeof z!="undefined"&&e<_(Y(q,Z(p,2)))||typeof A!="undefined"&&e>_(Y(C,Z(D,2)))))return!0;if(f==4&&(typeof z!="undefined"&&e<q||typeof A!="undefined"&&e>C))return!0}if(x){typeof c!="undefined"&&(c+=1);var g=!1;a.each(x,function(){if(g)return;var e=this;if(a.inArray(b,e[2])>-1||a.inArray("*",e[2])>-1)if(typeof c!="undefined"&&a.inArray(c,e[1])>-1||a.inArray("*",e[1])>-1)if(typeof d!="undefined"&&a.inArray(d,e[0])>-1||a.inArray("*",e[0])>-1){if(e[3]=="*")return g=!0;var f=(new Date(b,c-1,d)).getDay();if(a.inArray(f,e[3])>-1)return g=!0}});if(g)return!0}return!1},U=function(a){return(a+"").match(/^\-?[0-9]+$/)?!0:!1},V=function(b){a(".dp_caption",h).html(b);if(!!a.isArray(I.settings.direction)||_(I.settings.direction)!==0){var c=t,d=s,f,g;e=="days"?(g=d-1<0?Y(c-1,"11"):Y(c,Z(d-1,2)),f=d+1>11?Y(c+1,"00"):Y(c,Z(d+1,2))):e=="months"?(g=c-1,f=c+1):e=="years"&&(g=c-7,f=c+7),T(g)?(a(".dp_previous",h).addClass("dp_blocked"),a(".dp_previous",h).removeClass("dp_hover")):a(".dp_previous",h).removeClass("dp_blocked"),T(f)?(a(".dp_next",h).addClass("dp_blocked"),a(".dp_next",h).removeClass("dp_hover")):a(".dp_next",h).removeClass("dp_blocked")}},W=function(){if(i.text()==""||e=="days"){if(i.text()==""){I.settings.always_visible||f.css("left",-1e3),f.css({display:"block"}),P();var a=i.outerWidth(),b=i.outerHeight();h.css("width",a),j.css({width:a,height:b}),k.css({width:a,height:b}),l.css("width",a),f.css({display:"none"})}else P();j.css("display","none"),k.css("display","none")}else e=="months"?(Q(),i.css("display","none"),k.css("display","none")):e=="years"&&(R(),i.css("display","none"),j.css("display","none"));(I.settings.always_show_clear||I.settings.always_visible||J.val()!="")&&l.css("display")!="block"?l.css("display",""):l.css("display","none")},X=function(a,b,c,d,e){var f=new Date(a,b,c),g=d=="days"?E:d=="months"?F:G,h=O(f);J.val(h),J.trigger("change"),I.settings.always_visible&&(v=f.getMonth(),s=f.getMonth(),w=f.getFullYear(),t=f.getFullYear(),u=f.getDate(),g.removeClass("dp_selected"),e.addClass("dp_selected")),I.hide(),ba(f),I.settings.onSelect&&typeof I.settings.onSelect=="function"&&I.settings.onSelect(h,a+"-"+Z(b+1,2)+"-"+Z(c,2),new Date(a,b,c))},Y=function(){var a="";for(var b=0;b<arguments.length;b++)a+=arguments[b]+"";return a},Z=function(a,b){a+="";while(a.length<b)a="0"+a;return a},_=function(a){return parseInt(a,10)},ba=function(a){if(I.settings.pair)if(!I.settings.pair.data||!I.settings.pair.data("MyZebra_DatePicker"))I.settings.pair.data("zdp_reference_date",a);else{var b=I.settings.pair.data("MyZebra_DatePicker");b.update({reference_date:a}),b.settings.always_visible&&b.show()}};I._keyup=function(a){return(f.css("display")=="block"||a.which==27)&&I.hide(),!0},I._mousedown=function(b){if(f.css("display")=="block"){if(a(b.target).get(0)===g.get(0))return!0;a(b.target).parents().filter(".MyZebra_DatePicker").length==0&&I.hide()}return!0},K()},a.fn.MyZebra_DatePicker=function(b){return this.each(function(){if(undefined!=a(this).data("MyZebra_DatePicker")){var c=a(this).data("MyZebra_DatePicker");c.icon.remove(),c.datepicker.remove(),a(document).unbind("keyup",c._keyup),a(document).unbind("mousedown",c._mousedown)}var c=new a.MyZebra_DatePicker(this,b);a(this).data("MyZebra_DatePicker",c)})}})(jQuery)

/**
 CLEditor WYSIWYG HTML Editor v1.3.0
 http://premiumsoftware.net/cleditor
 requires jQuery v1.4.2 or later

 Copyright 2010, Chris Landowski, Premium Software, LLC
 Dual licensed under the MIT or GPL Version 2 licenses.
**/
;(function(a){function E(b){var e=this,f=b.target,i=a.data(f,d),j=B[i],k=j.popupName,l=z[k];if(e.disabled||a(f).attr(h)==h)return;var m={editor:e,button:f,buttonName:i,popup:l,popupName:k,command:j.command,useCSS:e.options.useCSS};if(j.buttonClick&&j.buttonClick(b,m)===!1)return!1;if(i=="source")ba(e)?(delete e.range,e.$area.hide(),e.$frame.show(),f.title=j.title):(e.$frame.hide(),e.$area.show(),f.title="Show Rich Text"),setTimeout(function(){V(e)},100);else if(!ba(e)){if(k){var n=a(l);if(k=="url"){if(i=="link"&&Z(e)==="")return $(e,"A selection is required when inserting a link.",f),!1;n.children(":button").unbind(g).bind(g,function(){var b=n.find(":text"),c=a.trim(b.val());c!==""&&M(e,m.command,c,null,m.button),b.val("http://"),R(),N(e)})}else k=="pastetext"&&n.children(":button").unbind(g).bind(g,function(){var a=n.find("textarea"),b=a.val().replace(/\n/g,"<br />");b!==""&&M(e,m.command,b,null,m.button),a.val(""),R(),N(e)});if(f!==a.data(l,c))return _(e,l,f),!1;return}if(i=="print")e.$frame[0].contentWindow.print();else if(!M(e,m.command,m.value,m.useCSS,f))return!1}N(e)}function F(c){var e=a(c.target).closest("div");e.css(b,e.data(d)?"#FFF":"#FFC")}function G(c){a(c.target).closest("div").css(b,"transparent")}function H(b){var e=this,f=b.data.popup,g=b.target;if(f===z.msg||a(f).hasClass(u))return;var h=a.data(f,c),i=a.data(h,d),j=B[i],k=j.command,l,m=e.options.useCSS;i=="font"?l=g.style.fontFamily.replace(/"/g,""):i=="size"?(g.tagName=="DIV"&&(g=g.children[0]),l=g.innerHTML):i=="style"?l="<"+g.tagName+">":i=="color"?l=Q(g.style.backgroundColor):i=="highlight"&&(l=Q(g.style.backgroundColor),w?k="backcolor":m=!0);var n={editor:e,button:h,buttonName:i,popup:f,popupName:j.popupName,command:k,value:l,useCSS:m};if(j.popupClick&&j.popupClick(b,n)===!1)return;if(n.command&&!M(e,n.command,n.value,n.useCSS,h))return!1;R(),N(e)}function I(a){var b=1,c=0;for(var d=0;d<a.length;++d)b=(b+a.charCodeAt(d))%65521,c=(c+b)%65521;return c<<16|b}function J(a){a.$area.val(""),bb(a)}function K(c,d,e,f,g){if(z[c])return z[c];var h=a(i).hide().addClass(r).appendTo("body");if(f)h.html(f);else if(c=="color"){var j=d.colors.split(" ");j.length<10&&h.width("auto"),a.each(j,function(c,d){a(i).appendTo(h).css(b,"#"+d)}),e=t}else c=="font"?a.each(d.fonts.split(","),function(b,c){a(i).appendTo(h).css("fontFamily",c).html(c)}):c=="size"?a.each(d.sizes.split(","),function(b,c){a(i).appendTo(h).html("<font size="+c+">"+c+"</font>")}):c=="style"?a.each(d.styles,function(b,c){a(i).appendTo(h).html(c[1]+c[0]+c[1].replace("<","</"))}):c=="url"?(h.html('Enter URL:<br><input type=text value="http://" size=35><br><input type=button value="Submit">'),e=u):c=="pastetext"&&(h.html("Paste your content here and click submit.<br /><textarea cols=40 rows=3></textarea><br /><input type=button value=Submit>"),e=u);return!e&&!f&&(e=s),h.addClass(e),w&&h.attr(k,"on").find("div,font,p,h1,h2,h3,h4,h5,h6").attr(k,"on"),(h.hasClass(s)||g===!0)&&h.children().hover(F,G),z[c]=h[0],h[0]}function L(a,b){b?(a.$area.attr(h,h),a.disabled=!0):(a.$area.removeAttr(h),delete a.disabled);try{w?a.doc.body.contentEditable=!b:a.doc.designMode=b?"off":"on"}catch(c){}V(a)}function M(a,b,c,d,e){W(a);if(!w){if(d===undefined||d===null)d=a.options.useCSS;a.doc.execCommand("styleWithCSS",0,d.toString())}var f=!0,g;if(w&&b.toLowerCase()=="inserthtml")O(a).pasteHTML(c);else{try{f=a.doc.execCommand(b,0,c||null)}catch(h){g=h.description,f=!1}f||("cutcopypaste".indexOf(b)>-1?$(a,"For security reasons, your browser does not support the "+b+" command. Try using the keyboard shortcut or context menu instead.",e):$(a,g?g:"Error executing the "+b+" command.",e))}return V(a),f}function N(a){setTimeout(function(){ba(a)?a.$area.focus():a.$frame[0].contentWindow.focus(),V(a)},0)}function O(a){return w?P(a).createRange():P(a).getRangeAt(0)}function P(a){return w?a.doc.selection:a.$frame[0].contentWindow.getSelection()}function Q(a){var b=/rgba?\((\d+), (\d+), (\d+)/.exec(a),c=a.split("");if(b){a=(b[1]<<16|b[2]<<8|b[3]).toString(16);while(a.length<6)a="0"+a}return"#"+(a.length==6?a:c[1]+c[1]+c[2]+c[2]+c[3]+c[3])}function R(){a.each(z,function(b,d){a(d).hide().unbind(g).removeData(c)})}function S(){var b="jquery.cleditor.css",c=a("link[href$='"+b+"']").attr("href");return c?c.substr(0,c.length-b.length)+"images/":""}function T(a){return"url("+S()+a+")"}function U(b){var c=b.$main,d=b.options;b.$frame&&b.$frame.remove();var e=b.$frame=a('<iframe frameborder="0" src="javascript:true;">').hide().appendTo(c),f=e[0].contentWindow,g=b.doc=f.document,h=a(g);g.open(),g.write(d.docType+"<html>"+(d.docCSSFile===""?"":'<head><link rel="stylesheet" type="text/css" href="'+d.docCSSFile+'" /></head>')+'<body style="'+d.bodyStyle+'"></body></html>'),g.close(),w&&h.click(function(){N(b)}),bb(b),w&&(h.bind("beforedeactivate beforeactivate selectionchange keypress",function(a){if(a.type=="beforedeactivate")b.inactive=!0;else if(a.type=="beforeactivate")!b.inactive&&b.range&&b.range.length>1&&b.range.shift(),delete b.inactive;else if(!b.inactive){b.range||(b.range=[]),b.range.unshift(O(b));while(b.range.length>2)b.range.pop()}}),e.focus(function(){W(b)})),(a.browser.mozilla?h:a(f)).blur(function(){bc(b,!0)}),h.click(R).bind("keyup mouseup",function(){V(b)}),y?b.$area.show():e.show(),a(function(){var a=b.$toolbar,f=a.children("div:last"),g=c.width(),h=f.offset().top+f.outerHeight()-a.offset().top+1;a.height(h),h=(/%/.test(""+d.height)?c.height():parseInt(d.height))-h,e.width(g).height(h),b.$area.width(g).height(x?h-2:h),L(b,b.disabled),V(b)})}function V(b){!y&&a.browser.webkit&&!b.focused&&(b.$frame[0].contentWindow.focus(),window.focus(),b.focused=!0);var c=b.doc;w&&(c=O(b));var e=ba(b);a.each(b.$toolbar.find("."+o),function(f,g){var i=a(g),j=a.cleditor.buttons[a.data(g,d)],k=j.command,l=!0;if(b.disabled)l=!1;else if(j.getEnabled){var m={editor:b,button:g,buttonName:j.name,popup:z[j.popupName],popupName:j.popupName,command:j.command,useCSS:b.options.useCSS};l=j.getEnabled(m),l===undefined&&(l=!0)}else if((e||y)&&j.name!="source"||w&&(k=="undo"||k=="redo"))l=!1;else if(k&&k!="print"){w&&k=="hilitecolor"&&(k="backcolor");if(!w||k!="inserthtml")try{l=c.queryCommandEnabled(k)}catch(n){l=!1}}l?(i.removeClass(p),i.removeAttr(h)):(i.addClass(p),i.attr(h,h))})}function W(a){w&&a.range&&a.range[0].select()}function X(a){setTimeout(function(){ba(a)?a.$area.select():M(a,"selectall")},0)}function Y(b){W(b);var c=O(b);if(w)return c.htmlText;var d=a("<layer>")[0];d.appendChild(c.cloneContents());var e=d.innerHTML;return d=null,e}function Z(a){return W(a),w?O(a).text:P(a).toString()}function $(a,b,c){var d=K("msg",a.options,v);d.innerHTML=b,_(a,d,c)}function _(b,d,e){var f,h,i,j=a(d);if(e){var k=a(e);f=k.offset(),h=--f.left,i=f.top+k.height()}else{var l=b.$toolbar;f=l.offset(),h=Math.floor((l.width()-j.width())/2)+f.left,i=f.top+l.height()-2}R(),j.css({left:h,top:i}).show(),e&&(a.data(d,c,e),j.bind(g,{popup:d},a.proxy(H,b))),setTimeout(function(){j.find(":text,textarea").eq(0).focus().select()},100)}function ba(a){return a.$area.is(":visible")}function bb(b,c){var d=b.$area.val(),f=b.options,g=f.updateFrame,h=a(b.doc.body);if(g){var i=I(d);if(c&&b.areaChecksum==i)return;b.areaChecksum=i}var j=g?g(d):d;j=j.replace(/<(?=\/?script)/ig,"&lt;"),f.updateTextArea&&(b.frameChecksum=I(j)),j!=h.html()&&(h.html(j),a(b).triggerHandler(e))}function bc(b,c){var d=a(b.doc.body).html(),f=b.options,g=f.updateTextArea,h=b.$area;if(g){var i=I(d);if(c&&b.frameChecksum==i)return;b.frameChecksum=i}var j=g?g(d):d;f.updateFrame&&(b.areaChecksum=I(j)),j!=h.val()&&(h.val(j),a(b).triggerHandler(e))}a.cleditor={defaultOptions:{width:500,height:250,controls:"bold italic underline strikethrough subscript superscript | font size style | color highlight removeformat | bullets numbering | outdent indent | alignleft center alignright justify | undo redo | rule image link unlink | cut copy paste pastetext | print source",colors:"FFF FCC FC9 FF9 FFC 9F9 9FF CFF CCF FCF CCC F66 F96 FF6 FF3 6F9 3FF 6FF 99F F9F BBB F00 F90 FC6 FF0 3F3 6CC 3CF 66C C6C 999 C00 F60 FC3 FC0 3C0 0CC 36F 63F C3C 666 900 C60 C93 990 090 399 33F 60C 939 333 600 930 963 660 060 366 009 339 636 000 300 630 633 330 030 033 006 309 303",fonts:"Arial,Arial Black,Comic Sans MS,Courier New,Narrow,Garamond,Georgia,Impact,Sans Serif,Serif,Tahoma,Trebuchet MS,Verdana",sizes:"1,2,3,4,5,6,7",styles:[["Paragraph","<p>"],["Header 1","<h1>"],["Header 2","<h2>"],["Header 3","<h3>"],["Header 4","<h4>"],["Header 5","<h5>"],["Header 6","<h6>"]],useCSS:!1,docType:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">',docCSSFile:"",bodyStyle:"margin:4px; font:10pt Arial,Verdana; cursor:text"},buttons:{init:"bold,,|italic,,|underline,,|strikethrough,,|subscript,,|superscript,,|font,,fontname,|size,Font Size,fontsize,|style,,formatblock,|color,Font Color,forecolor,|highlight,Text Highlight Color,hilitecolor,color|removeformat,Remove Formatting,|bullets,,insertunorderedlist|numbering,,insertorderedlist|outdent,,|indent,,|alignleft,Align Text Left,justifyleft|center,,justifycenter|alignright,Align Text Right,justifyright|justify,,justifyfull|undo,,|redo,,|rule,Insert Horizontal Rule,inserthorizontalrule|image,Insert Image,insertimage,url|link,Insert Hyperlink,createlink,url|unlink,Remove Hyperlink,|cut,,|copy,,|paste,,|pastetext,Paste as Text,inserthtml,|print,,|source,Show Source"},imagesPath:function(){return S()}},a.fn.cleditor=function(b){var c=a([]);return this.each(function(d,e){if(e.tagName=="TEXTAREA"){var g=a.data(e,f);g||(g=new cleditor(e,b)),c=c.add(g)}}),c};var b="backgroundColor",c="button",d="buttonName",e="change",f="cleditor",g="click",h="disabled",i="<div>",j="transparent",k="unselectable",l="cleditorMain",m="cleditorToolbar",n="cleditorGroup",o="cleditorButton",p="cleditorDisabled",q="cleditorDivider",r="cleditorPopup",s="cleditorList",t="cleditorColor",u="cleditorPrompt",v="cleditorMsg",w=a.browser.msie,x=/msie\s6/i.test(navigator.userAgent),y=/iphone|ipad|ipod/i.test(navigator.userAgent),z={},A,B=a.cleditor.buttons;a.each(B.init.split("|"),function(a,b){var c=b.split(","),d=c[0];B[d]={stripIndex:a,name:d,title:c[1]===""?d.charAt(0).toUpperCase()+d.substr(1):c[1],command:c[2]===""?d:c[2],popupName:c[3]===""?d:c[3]}}),delete B.init,cleditor=function(b,c){var e=this;e.options=c=a.extend({},a.cleditor.defaultOptions,c);var h=e.$area=a(b).hide().data(f,e).blur(function(){bb(e,!0)}),j=e.$main=a(i).addClass(l).width(c.width).height(c.height),p=e.$toolbar=a(i).addClass(m).appendTo(j),r=a(i).addClass(n).appendTo(p);a.each(c.controls.split(" "),function(b,f){if(f==="")return!0;if(f=="|"){var h=a(i).addClass(q).appendTo(r);r=a(i).addClass(n).appendTo(p)}else{var j=B[f],l=a(i).data(d,j.name).addClass(o).attr("title",j.title).bind(g,a.proxy(E,e)).appendTo(r).hover(F,G),m={};j.css?m=j.css:j.image&&(m.backgroundImage=T(j.image)),j.stripIndex&&(m.backgroundPosition=j.stripIndex*-24),l.css(m),w&&l.attr(k,"on"),j.popupName&&K(j.popupName,c,j.popupClass,j.popupContent,j.popupHover)}}),j.insertBefore(h).append(h),A||(a(document).click(function(b){var c=a(b.target);c.add(c.parents()).is("."+u)||R()}),A=!0),/auto|%/.test(""+c.width+c.height)&&a(window).resize(function(){U(e)}),U(e)};var C=cleditor.prototype,D=[["clear",J],["disable",L],["execCommand",M],["focus",N],["hidePopups",R],["sourceMode",ba,!0],["refresh",U],["select",X],["selectedHTML",Y,!0],["selectedText",Z,!0],["showMessage",$],["updateFrame",bb],["updateTextArea",bc]];a.each(D,function(a,b){C[b[0]]=function(){var a=this,c=[a];for(var d=0;d<arguments.length;d++)c.push(arguments[d]);var e=b[1].apply(a,c);return b[2]?e:a}}),C.change=function(b){var c=a(this);return b?c.bind(e,b):c.trigger(e)}})(jQuery);


/**
 * DropKick
 *
 * Highly customizable <select> lists
 * https://github.com/JamieLottering/DropKick
 *
 * &copy; 2011 Jamie Lottering <http://github.com/JamieLottering>
 *                        <http://twitter.com/JamieLottering>
 * 
 */
;(function(a,b,c){function d(a,b){var c=a.keyCode,d=b.data("dropkick"),g=b.find(".dk_options"),j=b.hasClass("dk_open"),k=b.find(".dk_option_current"),l=g.find("li").first(),m=g.find("li").last(),n,p;switch(c){case o.enter:j?(e(k.find("a"),b),h(b)):i(b),a.preventDefault();break;case o.up:p=k.prev("li"),j?p.length?f(p,b):f(m,b):i(b),a.preventDefault();break;case o.down:j?(n=k.next("li").first(),n.length?f(n,b):f(l,b)):i(b),a.preventDefault();break;default:}}function e(a,b,c){var d,e,f;d=a.attr("data-dk-dropdown-value"),e=a.text(),f=b.data("dropkick"),$select=f.$select,$select.val(d),b.find(".dk_label").text(e),c=c||!1,f.settings.change&&!c?f.settings.change.call($select,d,e):c||$select.trigger("change")}function f(a,b){b.find(".dk_option_current").removeClass("dk_option_current"),a.addClass("dk_option_current"),g(b,a)}function g(a,b){var c=b.prevAll("li").outerHeight()*b.prevAll("li").length;a.find(".dk_options_inner").animate({scrollTop:c+"px"},0)}function h(a){a.removeClass("dk_open")}function i(a){var b=a.data("dropkick");a.find(".dk_options").css({top:a.find(".dk_toggle").outerHeight()-1}),a.toggleClass("dk_open")}function j(b,c){var d=b,e=[],f;d=d.replace("{{ id }}",c.id),d=d.replace("{{ label }}",c.label),d=d.replace("{{ tabindex }}",c.tabindex);if(c.options&&c.options.length)for(var g=0,h=c.options.length;g<h;g++){var i=a(c.options[g]),j="dk_option_current",l=q;l=l.replace("{{ value }}",i.val()),l=l.replace("{{ current }}",k(i.val())===c.value?j:""),l=l.replace("{{ text }}",i.text()),e[e.length]=l}return f=a(d),f.find(".dk_options_inner").html(e.join("")),f}function k(b){return a.trim(b).length>0?b:!1}var l=!1;a.browser.msie&&a.browser.version.substr(0,1)<7?l=!0:c.documentElement.className=c.documentElement.className+" dk_fouc";var m={},n=[],o={left:37,up:38,right:39,down:40,enter:13},p=['<div class="dk_container_wrapper">','<div class="dk_container" id="dk_container_{{ id }}" tabindex="{{ tabindex }}">','<a class="dk_toggle">','<span class="dk_label">{{ label }}</span>',"</a>",'<div class="dk_options">','<ul class="dk_options_inner">',"</ul>","</div>","</div>","</div>"].join(""),q='<li class="{{ current }}"><a data-dk-dropdown-value="{{ value }}">{{ text }}</a></li>',r={startSpeed:1e3,theme:!1,change:!1},s=!1;m.init=function(b){return b=a.extend({},r,b),this.each(function(){var c=a(this),d=c.find(":selected").first(),e=c.find("option"),f=c.data("dropkick")||{},g=c.attr("id")||c.attr("name"),h=b.width||c.outerWidth(),i=c.attr("tabindex")?c.attr("tabindex"):"",l=!1,m;if(f.id)return c;f.settings=b,f.tabindex=i,f.id=g,f.$original=d,f.$select=c,f.value=k(c.val())||k(d.attr("value")),f.label=d.text(),f.options=e,l=j(p,f),l.find(".dk_toggle").css({width:h+"px"}),c.before(l),l=a("#dk_container_"+g).fadeIn(b.startSpeed),m=b.theme?b.theme:"default",l.addClass("dk_theme_"+m),f.theme=m,f.$dk=l,c.data("dropkick",f),l.data("dropkick",f),n[n.length]=c,l.bind("focus.dropkick",function(a){l.addClass("dk_focus")}).bind("blur.dropkick",function(a){l.removeClass("dk_open dk_focus")}),setTimeout(function(){c.hide()},0)})},m.theme=function(b){var c=a(this),d=c.data("dropkick"),e=d.$dk,f="dk_theme_"+d.theme;e.removeClass(f).addClass("dk_theme_"+b),d.theme=b},m.reset=function(){for(var a=0,b=n.length;a<b;a++){var c=n[a].data("dropkick"),d=c.$dk,g=d.find("li").first();d.find(".dk_label").text(c.label),d.find(".dk_options_inner").animate({scrollTop:0},0),f(g,d),e(g,d,!0)}},a.fn.dropkick=function(a){if(!l){if(m[a])return m[a].apply(this,Array.prototype.slice.call(arguments,1));if(typeof a=="object"||!a)return m.init.apply(this,arguments)}},a(function(){a(".dk_toggle").live("click",function(c){var d=a(this).parents(".dk_container").first();return i(d),"ontouchstart"in b&&(d.addClass("dk_touch"),d.find(".dk_options_inner").addClass("scrollable vertical")),c.preventDefault(),!1}),a(".dk_options a").live(a.browser.msie?"mousedown":"click",function(b){var c=a(this),d=c.parents(".dk_container").first(),g=d.data("dropkick");return h(d),e(c,d),f(c.parent(),d),b.preventDefault(),!1}),a(c).bind("keydown.dk_nav",function(b){var c=a(".dk_container.dk_open"),e=a(".dk_container.dk_focus"),f=null;c.length?f=c:e.length&&!c.length&&(f=e),f&&d(b,f)})})})(jQuery,window,document)

/**
 *  jQuery Animation Easing Extended Functios
 * 
 */
;jQuery.extend(jQuery.easing,{linear:function(a,b,c,d){return c+d*a},backEaseIn:function(a,b,c,d){var e=c+d,f=1.70158;return e*(a/=1)*a*((f+1)*a-f)+c},backEaseOut:function(a,b,c,d){var e=c+d,f=1.70158;return e*((a=a/1-1)*a*((f+1)*a+f)+1)+c},backEaseInOut:function(a,b,c,d){var e=c+d,f=1.70158;return(a/=.5)<1?e/2*a*a*(((f*=1.525)+1)*a-f)+c:e/2*((a-=2)*a*(((f*=1.525)+1)*a+f)+2)+c},bounceEaseIn:function(a,b,c,d){var e=c+d,f=this.bounceEaseOut(1-a,1,0,d);return e-f+c},bounceEaseOut:function(a,b,c,d){var e=c+d;return a<1/2.75?e*7.5625*a*a+c:a<2/2.75?e*(7.5625*(a-=1.5/2.75)*a+.75)+c:a<2.5/2.75?e*(7.5625*(a-=2.25/2.75)*a+.9375)+c:e*(7.5625*(a-=2.625/2.75)*a+.984375)+c},circEaseIn:function(a,b,c,d){var e=c+d;return-e*(Math.sqrt(1-(a/=1)*a)-1)+c},circEaseOut:function(a,b,c,d){var e=c+d;return e*Math.sqrt(1-(a=a/1-1)*a)+c},circEaseInOut:function(a,b,c,d){var e=c+d;return(a/=.5)<1?-e/2*(Math.sqrt(1-a*a)-1)+c:e/2*(Math.sqrt(1-(a-=2)*a)+1)+c},cubicEaseIn:function(a,b,c,d){var e=c+d;return e*(a/=1)*a*a+c},cubicEaseOut:function(a,b,c,d){var e=c+d;return e*((a=a/1-1)*a*a+1)+c},cubicEaseInOut:function(a,b,c,d){var e=c+d;return(a/=.5)<1?e/2*a*a*a+c:e/2*((a-=2)*a*a+2)+c},elasticEaseIn:function(a,b,c,d){var e=c+d;if(a==0)return c;if(a==1)return e;var f=.25,g,h=e;return h<Math.abs(e)?(h=e,g=f/4):g=f/(2*Math.PI)*Math.asin(e/h),-(h*Math.pow(2,10*(a-=1))*Math.sin((a*1-g)*2*Math.PI/f))+c},elasticEaseOut:function(a,b,c,d){var e=c+d;if(a==0)return c;if(a==1)return e;var f=.25,g,h=e;return h<Math.abs(e)?(h=e,g=f/4):g=f/(2*Math.PI)*Math.asin(e/h),-(h*Math.pow(2,-10*a)*Math.sin((a*1-g)*2*Math.PI/f))+e},expoEaseIn:function(a,b,c,d){var e=c+d;return a==0?c:e*Math.pow(2,10*(a-1))+c-e*.001},expoEaseOut:function(a,b,c,d){var e=c+d;return a==1?e:d*1.001*(-Math.pow(2,-10*a)+1)+c},expoEaseInOut:function(a,b,c,d){var e=c+d;return a==0?c:a==1?e:(a/=.5)<1?e/2*Math.pow(2,10*(a-1))+c-e*5e-4:e/2*1.0005*(-Math.pow(2,-10*--a)+2)+c},quadEaseIn:function(a,b,c,d){var e=c+d;return e*(a/=1)*a+c},quadEaseOut:function(a,b,c,d){var e=c+d;return-e*(a/=1)*(a-2)+c},quadEaseInOut:function(a,b,c,d){var e=c+d;return(a/=.5)<1?e/2*a*a+c:-e/2*(--a*(a-2)-1)+c},quartEaseIn:function(a,b,c,d){var e=c+d;return e*(a/=1)*a*a*a+c},quartEaseOut:function(a,b,c,d){var e=c+d;return-e*((a=a/1-1)*a*a*a-1)+c},quartEaseInOut:function(a,b,c,d){var e=c+d;return(a/=.5)<1?e/2*a*a*a*a+c:-e/2*((a-=2)*a*a*a-2)+c},quintEaseIn:function(a,b,c,d){var e=c+d;return e*(a/=1)*a*a*a*a+c},quintEaseOut:function(a,b,c,d){var e=c+d;return e*((a=a/1-1)*a*a*a*a+1)+c},quintEaseInOut:function(a,b,c,d){var e=c+d;return(a/=.5)<1?e/2*a*a*a*a*a+c:e/2*((a-=2)*a*a*a*a+2)+c},sineEaseIn:function(a,b,c,d){var e=c+d;return-e*Math.cos(a*(Math.PI/2))+e+c},sineEaseOut:function(a,b,c,d){var e=c+d;return e*Math.sin(a*(Math.PI/2))+c},sineEaseInOut:function(a,b,c,d){var e=c+d;return-e/2*(Math.cos(Math.PI*a)-1)+c}})


/**
*
*   MyZebra Parser, advanced parser for arithmetic,logical and comparision expressions
*       by Nikos M. <nikos.m@icanlocalize.com>
*
*   Main Features:
*       + user variables
*       + support mathematical, and date functions
*       + limited date parsing
*
*   Additional Features:
*       + typed tokens
*       + typed user variables
*       + added string literals
*       + support advanced mathematical, string and date functions
*       + support advanced date operations (like (date + 3 days) or (3 days=date1-date2)) (not yet)
*       + support typecasting
*       + can parse and format every localized PHP date format
*       + precompilation of expressions into functions
*       + faster, optimized code
*       + use of closures for encapsulation and better access
*       + heavy refactoring, and various bug fixes
*
*   inspired by 
*       JS Expression Evaluator by Prasad P. Khandekar
*
**/
;(function(a){a.MyZebraParser=a.MyZebraParser||function(a){function h(a,b,c,f){var h,i,j,k,l,m,n,o,p,q;if(!a.isFunction)throw"Unsupported function token ["+a.val+"]";h=a.val,p=new Array,i=g.ARG_TERMINAL;while(!b.IsEmpty()){i=b.Pop();if(!i.isArgTerminal)p[p.length]=i;else break}switch(h){case"ARRAY":if(p.length<1)throw h+" requires atleast one operand!";var r=new Array;k=0,q=p.length;while(--q>=0){i=p[q];if(i.isVariable){k=f[i.val];if(k==undefined||k==null)throw"Variable ["+i.val+"] not defined";i=k}r=r.concat(g.toArray(i.val))}b.Push(g.makeToken(r,g.TOKEN_TYPE.ARRAY));break;case"TODAY":b.Push(g.makeToken(e.currentDate(),g.TOKEN_TYPE.DATE));break;case"ACOS":case"ASIN":case"ATAN":throw"Function ["+h+"] is not implemented!";case"ABS":case"CHR":case"COS":case"FIX":case"HEX":case"LOG":case"RAND":case"ROUND":case"SIN":case"SQRT":case"TAN":if(h!="RAND"){if(p.length<1)throw h+" requires atleast one argument!";if(p.length>1)throw h+" requires only one argument!"}else{if(p.length<1)throw h+" requires atleast one argument!";if(p.length>2)throw h+" requires at most two arguments!"}i=p[0];if(i.isVariable){k=f[i.val];if(k==undefined||k==null)throw"Variable ["+i.val+"] not defined";i=k}k=i.val;var s=0,t=0;if(!i.isNumber)throw h+" operates on numeric operands only!";k=g.toNumber(i.val);if(h=="RAND"){t=Math.floor(k);if(p.length==2){i=p[1];if(i.isVariable){k=f[i.val];if(k==undefined||k==null)throw"Variable ["+i.val+"] not defined";i=k}if(!i.isNumber)throw h+" operates on numeric operands only!";k=g.toNumber(i.val),s=Math.floor(k)}}h=="ABS"?b.Push(g.makeToken(Math.abs(k),g.TOKEN_TYPE.NUMBER)):h=="CHR"?b.Push(g.makeToken(String.fromCharCode(k),g.TOKEN_TYPE.STRING_LITERAL)):h=="COS"?b.Push(g.makeToken(Math.cos(k),g.TOKEN_TYPE.NUMBER)):h=="FIX"?b.Push(g.makeToken(Math.floor(k),g.TOKEN_TYPE.NUMBER)):h=="HEX"?b.Push(g.makeToken(k.toString(16),g.TOKEN_TYPE.STRING_LITERAL)):h=="LOG"?b.Push(g.makeToken(Math.log(k),g.TOKEN_TYPE.NUMBER)):h=="RAND"?b.Push(g.makeToken(Math.round(s+(t-s)*Math.random()),g.TOKEN_TYPE.NUMBER)):h=="ROUND"?b.Push(g.makeToken(Math.round(k),g.TOKEN_TYPE.NUMBER)):h=="SIN"?b.Push(g.makeToken(Math.sin(k),g.TOKEN_TYPE.NUMBER)):h=="SQRT"?b.Push(g.makeToken(Math.sqrt(k),g.TOKEN_TYPE.NUMBER)):h=="TAN"&&b.Push(g.makeToken(Math.tan(k),g.TOKEN_TYPE.NUMBER));break;case"STR":if(p.length<1)throw h+" requires atleast one argument!";if(p.length>2)throw h+" requires at most two arguments!";i=p[p.length-1];if(i.isVariable){k=f[i.val];if(k==undefined||k==null)throw"Variable ["+i.val+"] not defined";i=k}if(i.isDate){var u="";if(p.length==2){l=p[0];if(l.isVariable){k=f[l.val];if(k==undefined||k==null)throw"Variable ["+l.val+"] not defined";l=k}if(!l.isStringLiteral)throw"format argument for "+h+" must be a string!";u=l.val}b.Push(g.makeToken(e.formatDate(i.val,u),g.TOKEN_TYPE.STRING_LITERAL))}else b.Push(g.makeToken(i.val.toString(),g.TOKEN_TYPE.STRING_LITERAL));break;case"ASC":if(p.length>1)throw h+" requires only one argument!";if(p.length<1)throw h+" requires atleast one argument!";i=p[0];if(i.isVariable){k=f[i.val];if(k==undefined||k==null)throw"Variable ["+i.val+"] not defined";i=k}if(!i.isStringLiteral)throw h+" requires a string type operand!";b.Push(g.makeToken(i.val.charCodeAt(0),g.TOKEN_TYPE.NUMBER));break;case"REGEX":if(p.length<1)throw h+" requires atleast one argument!";if(p.length>2)throw h+" requires at most two arguments!";i=p[p.length-1];if(i.isVariable){k=f[i.val];if(k==undefined||k==null)throw"Variable ["+i.val+"] not defined";i=k}if(!i.isStringLiteral)throw h+" operates on string type operands!";var v=g.EMPTY_STRING;if(p.length==2){v=p[0];if(v.isVariable){k=f[v.val];if(k==undefined||k==null)throw"Variable ["+v.val+"] not defined";v=k}if(!v.isStringLiteral)throw h+" operates on string type operands!"}b.Push(g.makeToken(d.Regex(i.val.toString(),v.val.toString()),g.TOKEN_TYPE.REGEX));break;case"LCASE":case"UCASE":case"NUM":if(p.length<1)throw h+" requires atleast one argument!";if(p.length>1)throw h+" requires only one argument!";i=p[0];if(i.isVariable){k=f[i.val];if(k==undefined||k==null)throw"Variable ["+i.val+"] not defined";i=k}if(!i.isStringLiteral&&h!="NUM")throw h+" requires a string type operand!";if(h=="LCASE")b.Push(g.makeToken(i.val.toLowerCase(),g.TOKEN_TYPE.STRING_LITERAL));else if(h=="UCASE")b.Push(g.makeToken(i.val.toUpperCase(),g.TOKEN_TYPE.STRING_LITERAL));else if(h=="NUM"){k=g.toNumber(i.val)+0;if(isNaN(k))throw h+" cannot convert ["+i.val+"] to number!";b.Push(g.makeToken(k,g.TOKEN_TYPE.NUMBER))}break;case"LEN":if(p.length<1)throw h+" requires atleast one argument!";if(p.length>1)throw h+" requires only one argument!";i=p[0];if(i.isVariable){k=f[i.val];if(k==undefined||k==null)throw"Variable ["+i.val+"] not defined";i=k}if(!i.isArray&&!i.isStringLiteral)throw h+" requires a string or array type operand!";b.Push(g.makeToken(i.val.length,g.TOKEN_TYPE.NUMBER));break;case"USER":if(p.length<1)throw h+" requires atleast one argument!";if(p.length>1)throw h+" requires only one argument!";i=p[0];if(i.isVariable){k=f[i.val];if(k==undefined||k==null)throw"Variable ["+i.val+"] not defined";i=k}if(!i.isStringLiteral)throw h+" requires a string type operand!";b.Push(g.makeToken(d.User(i.val),g.TOKEN_TYPE.STRING_LITERAL));break;case"COOKIE":if(p.length<1)throw h+" requires atleast one argument!";if(p.length>1)throw h+" requires only one argument!";i=p[0];if(i.isVariable){k=f[i.val];if(k==undefined||k==null)throw"Variable ["+i.val+"] not defined";i=k}if(!i.isStringLiteral)throw h+" requires a string type operand!";b.Push(g.makeToken(d.Cookie(i.val),g.TOKEN_TYPE.STRING_LITERAL));break;case"CONTAINS":if(p.length<2)throw h+" requires atleast two arguments!";if(p.length>2)throw h+" requires only two arguments!";i=p[1];if(i.isVariable){k=f[i.val];if(k==undefined||k==null)throw"Variable ["+i.val+"] not defined";i=k}j=p[0];if(j.isVariable){k=f[j.val];if(k==undefined||k==null)throw"Variable ["+j.val+"] not defined";j=k}if(!i.isArray)throw h+" requires an array as first argument!";var w=!1;w=d.Contains(i.val,j.val),b.Push(g.makeToken(w,g.TOKEN_TYPE.BOOLEAN));break;case"DATE":if(p.length<2)throw h+" requires atleast two arguments!";if(p.length>2)throw h+" requires only two arguments!";i=p[1];if(i.isVariable){k=f[i.val];if(k==undefined||k==null)throw"Variable ["+i.val+"] not defined";i=k}l=p[0];if(l.isVariable){o=f[l.val];if(o==undefined||o==null)throw"Variable ["+l.val+"] not defined";l=o}var x={};if(!i.isStringLiteral||!l.isStringLiteral)throw h+" requires string type operands!";if(!g.isDate(i.val,l.val,x))throw h+" can not convert ["+i.val+"] to a valid date with format ["+l.val+"]!";if(x.date)b.Push(g.makeToken(x.date,g.TOKEN_TYPE.DATE));else throw h+" unknown error";break;case"LEFT":case"RIGHT":if(p.length<2)throw h+" requires atleast two arguments!";if(p.length>2)throw h+" requires only two arguments!";for(q=0;q<p.length;q++){i=p[q];if(i.isVariable){k=f[i.val];if(k==undefined||k==null)throw"Variable ["+i.val+"] not defined";i=k}if(q==0&&!i.isNumber)throw h+" operator requires numeric length!";if(q==1&&!i.isStringLiteral)throw h+" operator requires a string operand!";p[q]=i}i=p[1].val.toString(),k=g.toNumber(p[0].val),h=="LEFT"?b.Push(g.makeToken(i.substring(0,k),g.TOKEN_TYPE.STRING_LITERAL)):b.Push(g.makeToken(i.substr(i.length-k,k),g.TOKEN_TYPE.STRING_LITERAL));break;case"MID":case"IIF":if(p.length<3)throw h+" requires atleast three arguments!";if(p.length>3)throw h+" requires only three arguments!";for(q=0;q<p.length;q++){i=p[q];if(i.isVariable){k=f[i.val];if(k==undefined||k==null)throw"Variable ["+i.val+"] not defined";i=k}if(h=="MID"&&q<=1&&!i.isNumber)throw h+" operator requires numeric lengths!";if(h=="MID"&&q==2&&!i.isStringLiteral)throw h+" operator requires a string input!";if(h=="IIF"&&q==2&&!i.isBoolean&&!i.isNumber)throw h+" operator requires boolean condition!";p[q]=i}h=="MID"?(i=p[2].val.toString(),m=g.toNumber(p[1].val),n=g.toNumber(p[0].val),b.Push(g.makeToken(i.substring(m,n),g.TOKEN_TYPE.STRING_LITERAL))):(i=g.toBoolean(p[2].val),i?m=p[1]:m=p[0],b.Push(m));break;case"AVG":case"MAX":case"MIN":if(p.length<1)throw h+" requires atleast one operand!";var y=[];q=p.length;while(--q>=0){i=p[q];if(i.isVariable){k=f[i.val];if(k==undefined||k==null)throw"Variable ["+i.val+"] not defined";i=k}if(!i.isNumber&&!i.isArray)throw h+" requires numeric or array operands only!";i.isArray?y=y.concat(i.val):y=y.concat(g.toArray(g.toNumber(i.val)))}q=-1,k=0;while(++q<y.length)i=y[q],h=="AVG"?k+=i:h=="MAX"?q==0?k=i:k<i&&(k=i):h=="MIN"&&(q==0?k=i:k>i&&(k=i));h=="AVG"&&y.length?b.Push(g.makeToken(k/y.length,g.TOKEN_TYPE.NUMBER)):h=="AVG"?b.Push(g.makeToken(0,g.TOKEN_TYPE.NUMBER)):b.Push(g.makeToken(k,g.TOKEN_TYPE.NUMBER))}}function i(a){var b,c,d,e,h,i,j,k;k=!1,d=0,arrPFix=new Array,b=new f;for(c=0;c<a.length;c++){e=a[c];switch(e.type){case g.TOKEN_TYPE.LEFT_PAREN:b.Size()>0&&b.Get(0).isFunction&&(arrPFix[d]=g.ARG_TERMINAL,d++),b.Push(e);break;case g.TOKEN_TYPE.RIGHT_PAREN:k=!0;while(!b.IsEmpty()){e=b.Pop();if(!e.isLeftParen)arrPFix[d]=e,d++;else{k=!1;break}}if(b.IsEmpty()&&k)throw"Unbalanced parenthesis!";break;case g.TOKEN_TYPE.COMMA:while(!b.IsEmpty()){e=b.Get(0);if(e.isLeftParen)break;arrPFix[d]=b.Pop(),d++}break;case g.TOKEN_TYPE.ARITHMETIC_OP:case g.TOKEN_TYPE.LOGICAL_OP:case g.TOKEN_TYPE.COMPARISON_OP:switch(e.val){default:if(e.val=="-"){j=null,c>0&&(j=a[c-1]),i=a[c+1];if(j==null||j.isArithmeticOp||j.isLeftParen||j.isComma)e=g.UNARY_NEGATIVE}if(e.val=="+"){j=null,c>0&&(j=a[c-1]),i=a[c+1];if(j==null||j.isArithmeticOp||j.isLeftParen||j.isComma)break}h=g.EMPTY_TOKEN,b.IsEmpty()||(h=b.Get(0));if(b.IsEmpty()||!b.IsEmpty()&&h.isLeftParen)b.Push(e);else if(e.precedence>=h.precedence)b.Push(e);else{while(!b.IsEmpty()){h=b.Get(0);if(h.isLeftParen||h.precedence<e.precedence)break;arrPFix[d]=b.Pop(),d++}b.Push(e)}}break;default:if(e.type!=g.TOKEN_TYPE.FUNCTION)arrPFix[d]=e,d++;else{h=g.EMPTY_TOKEN,b.IsEmpty()||(h=b.Get(0));if(b.IsEmpty()||!b.IsEmpty()&&h.isLeftParen)b.Push(e);else if(e.precedence>=h.precedence)b.Push(e);else{while(!b.IsEmpty()){h=b.Get(0);if(h.val=="("||h.precedence<e.precedence)break;arrPFix[d]=b.Pop(),d++}b.Push(e)}}}}while(!b.IsEmpty())arrPFix[d]=b.Pop(),d++;return arrPFix}var b,d=function(){function d(a){for(var b in a)a.hasOwnProperty(b)&&(c[b]=a[b])}function e(b){var c,d,e;if(!a){d=document.cookie.split(/;\s*/),a={},c=d.length;while(--c>=0)e=d[c].split("="),a[e[0]]=e[1]}return a[b]?a[b]:""}function f(a){a=a.toUpperCase();switch(a){case"ID":return c.user.ID+"";case"NAME":return c.user.display_name;case"ROLE":return c.user.role;case"LOGIN":return c.user.login;default:return""}return""}function g(a,c){var d="__REGEX_";return c=c.replace(/[^gimy]/,""),b[d+a+c]||(b[d+a+c]=new RegExp(a,c)),b[d+a+c]}function h(a,b){var c=!1,d=a.length;while(--d>=0)if(a[d]==b){c=!0;break}return c}var a=!1,b={},c={user:{ID:0,role:"",roles:[],login:"",display_name:""}};return{setParams:d,User:f,Cookie:e,Regex:g,Contains:h}}(),e=function(){var a={AM:"AM",PM:"PM"},b=["January","February","March","April","May","June","July","August","September","October","November","December"],c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],d=new Array("January","February","March","April","May","June","July","August","September","October","November","December"),e=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"),f=function(a){return parseInt(a,10)},g=function(a){return a.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},h=function(a,b){return(a+="").length<b?(new Array(++b-a.length)).join("0")+a:a},i=function(a){return typeof a=="string"||typeof a=="object"&&(a instanceof String||Object.prototype.toString.call(a)==="[object String]")?!0:!1},j=function(a,h){if(typeof a!="undefined"&&(a instanceof Date||Object.prototype.toString.call(a)==="[object Date]"))return a.setHours(0,0,0,0),a;if(typeof a=="undefined"||a==null||!i(a)||typeof h=="undefined"||h==null||!i(h))return!1;str_date=a+"",h+="";if(str_date!=""&&h!=""){var j=g(h.replace(/\s/g,"")),k=["d","D","j","l","N","S","w","F","m","M","n","Y","y"],l=new Array,m=new Array;for(var n=0;n<k.length;n++)(position=j.indexOf(k[n]))>-1&&l.push({character:k[n],position:position});l.sort(function(a,b){return a.position-b.position});for(var o=0;o<l.length;o++){var p=l[o];switch(p.character){case"d":m.push("0[1-9]|[12][0-9]|3[01]");break;case"D":m.push("[a-z]{3}");break;case"j":m.push("[1-9]|[12][0-9]|3[01]");break;case"l":m.push("[a-z]+");break;case"N":m.push("[1-7]");break;case"S":m.push("st|nd|rd|th");break;case"w":m.push("[0-6]");break;case"F":m.push("[a-z]+");break;case"m":m.push("0[1-9]|1[012]+");break;case"M":m.push("[a-z]{3}");break;case"n":m.push("[1-9]|1[012]");break;case"Y":m.push("[0-9]{4}");break;case"y":m.push("[0-9]{2}")}}if(m.length){l.reverse();for(var o=0;o<l.length;o++){var p=l[o];j=j.replace(p.character,"("+m[m.length-o-1]+")")}m=new RegExp("^"+j+"$","ig");if(segments=m.exec(str_date.replace(/\s/g,""))){var q,r,s,t=e,u=d,v,w=!0;l.reverse();for(var o=0;o<l.length;o++){var p=l[o];if(!w)break;switch(p.character){case"m":case"n":r=f(segments[o+1]);break;case"d":case"j":q=f(segments[o+1]);break;case"D":case"l":case"F":case"M":p.character=="D"||p.character=="l"?v=c:v=b,w=!1;for(var x=0;x<v.length;x++){if(w)break;var y=v[x];if(segments[o+1].toLowerCase()==y.substring(0,p.character=="D"||p.character=="M"?3:y.length).toLowerCase()){switch(p.character){case"D":segments[o+1]=t[x].substring(0,3);break;case"l":segments[o+1]=t[x];break;case"F":segments[o+1]=u[x],r=x+1;break;case"M":segments[o+1]=u[x].substring(0,3),r=x+1}w=!0}}break;case"Y":s=f(segments[o+1]);break;case"y":s="19"+f(segments[o+1])}}if(w){var a=new Date(s,(r||1)-1,q||1);if(a.getFullYear()==s&&a.getDate()==(q||1)&&a.getMonth()==(r||1)-1)return a.setHours(0,0,0,0),a}}}}return!1},k=function(a,d){if(typeof a!="undefined"&&a!=null&&a instanceof Date&&Object.prototype.toString.call(a)==="[object Date]"){a.setHours(0,0,0,0);if(d=="")return a.toString();var e="",f=a.getDate(),g=a.getDay(),i=c[g],j=a.getMonth()+1,k=b[j-1],l=a.getFullYear()+"";for(var m=0;m<d.length;m++){var n=d.charAt(m);switch(n){case"y":l=l.substr(2);case"Y":e+=l;break;case"m":j=h(j,2);case"n":e+=j;break;case"M":k=k.substr(0,3);case"F":e+=k;break;case"d":f=h(f,2);case"j":e+=f;break;case"D":i=i.substr(0,3);case"l":e+=i;break;case"N":g++;case"w":e+=g;break;case"S":f%10==1&&f!="11"?e+="st":f%10==2&&f!="12"?e+="nd":f%10==3&&f!="13"?e+="rd":e+="th";break;default:e+=n}}return e}return""};return{setDateLocaleStrings:function(d,e,f){typeof e!="undefined"&&(b=e),typeof d!="undefined"&&(c=d),typeof f!="undefined"&&(a=f)},parseDate:j,formatDate:k,isDate:function(a,b,c){var d=j(a,b);return d!==!1?(typeof c!="undefined"&&typeof c=="object"&&(c.date=d),!0):!1},currentDate:function(){var a=new Date;return a.setHours(0,0,0,0),a}}}(),f=function(){function a(){var a=0,b="";if(this.intIndex==0)return null;for(a=0;a<this.intIndex;a++)b.length==0?b+=this.arrStack[a].val:b+=","+this.arrStack[a].val;return b}function b(){return this.intIndex}function c(){return this.intIndex==0?!0:!1}function d(a){this.arrStack[this.intIndex++]=a}function e(){var a;return a=null,this.intIndex>0&&(a=this.arrStack[--this.intIndex]),a}function f(a){var b;return a>=0&&a<this.intIndex&&(b=this.arrStack[this.intIndex-a-1]),b}return function(){this.arrStack=new Array,this.intIndex=0,this.Size=b,this.IsEmpty=c,this.Push=d,this.Pop=e,this.Get=f,this.toString=a}}(),g=function(a){var b="__TOKEN_MAP_PREFIX__",e="abcdefghijklmnopqrstuvwxyz",f=e+e.toUpperCase(),h="_$"+f,i="0123456789",j=["^","*","/","%","+","-"],k=["NOT","!","OR","|","AND","&"],l=["<","<=",">",">=","<>","=","lt","lte","gt","gte","ne","eq"],m=["AVG","ABS","ACOS","ARRAY","ASC","ASIN","ATAN","CHR","CONTAINS","COOKIE","COS","DATE","FIX","HEX","IIF","LCASE","LEN","LEFT","LOG","MAX","MID","MIN","NUM","RAND","REGEX","RIGHT","ROUND","SIN","SQRT","STR","TAN","TODAY","UCASE","USER"],n="-",o="!",p="?",q={},r={},s={},t={},u={__DEFAULT__:0,STRING_LITERAL:8,REGEX:83,ARRAY:81,ARRAY_LITERAL:82,DATE:1,ARITHMETIC_OP:2,LOGICAL_OP:3,COMPARISON_OP:4,NUMBER:5,BOOLEAN:6,VARIABLE:7,FUNCTION:9,COMMA:10,LEFT_PAREN:11,LEFT_BRACKET:111,RIGHT_PAREN:12,RIGHT_BRACKET:122,ARG_TERMINAL:13,UNARY_NEGATIVE:14,UNARY_NEGATION:15,EMPTY_TOKEN:30,UNKNOWN:40},v=function(a){return typeof a=="undefined"||a==null?!1:!0},w=function(a){return v(a)?a!=""&&i.indexOf(a)>=0?!0:!1:!1},x=function(a){return v(a)?a!=""&&f.indexOf(a)>=0?!0:!1:!1},y=function(a){return v(a)?q[b+a]?!0:!1:!1},z=function(a){return v(a)?r[b+a]?!0:!1:!1},A=function(a){return v(a)?s[b+a]?!0:!1:!1},B=function(a){return v(a)?t[b+a]?!0:!1:!1},C=function(a){return v(a)?(c=a==""?"":a.charAt(0),c!=""&&h.indexOf(c)>=0?!0:!1):!1},D=function(a){return v(a)?typeof a=="object"&&(a instanceof Date||Object.prototype.toString.call(a)=="[object Date]")?!0:!1:!1},E=function(a){return v(a)?typeof a=="object"&&(a instanceof Array||Object.prototype.toString.call(a)=="[object Array]")?!0:!1:!1},F=function(a){return v(a)?typeof a=="object"&&(a instanceof RegExp||Object.prototype.toString.call(a)=="[object RegExp]")?!0:!1:!1},G=function(a){var b=typeof a;if(!v(a))return!1;if(D(a)||F(a)||E(a))return!1;if(b=="number"||b=="object"&&Object.prototype.toString.call(a)!=="[object Number]")return!0;var c=Number.NaN;return c=new Number(a),isNaN(c)?!1:!0},H=function(a){if(!v(a))return!1;var b=typeof a,c=a;return b=="boolean"?!0:b=="number"||b=="function"||b=="undefined"?!1:G(a)||D(a)||F(a)||E(a)?!1:(b=="object"&&(c=c.toString()),!c.toUpperCase||c.toUpperCase()!="TRUE"&&c.toUpperCase()!="FALSE"?!1:!0)},I=function(a,b){var c;typeof b=="undefined"?c=String.fromCharCode(32):c=b;var d=a.length,e="";if(d<0)return"";var f=d-1;while(f>-1){if(a.charAt(f)!=c){e=a.substring(0,f+1);break}f-=1}return e},J=function(a,b){var c;typeof b=="undefined"?c=String.fromCharCode(32):c=b;if(d<1)return"";var d=a.length,e="",f=0;while(f<d){if(a.charAt(f)!=c){e=a.substring(f,d);break}f+=1}return e},K=function(a,b){return a.length<1?"":(a=I(J(a,b),b),a==""?"":a)},L=function(){var a;for(a=0;a<j.length;a++)q[b+j[a]]=!0;for(a=0;a<k.length;a++)r[b+k[a]]=!0;for(a=0;a<l.length;a++)s[b+l[a]]=!0;for(a=0;a<m.length;a++)t[b+m[a]]=!0},M=function(a,b){var c={val:a,type:u.UNKNOWN},e=typeof a;if(typeof b=="undefined"||b==null||b=="")b=u.__DEFAULT__;switch(b){case u.EMPTY_TOKEN:c.type=u.EMPTY_TOKEN,c.isEmpty=!0,c.val="";break;case u.STRING_LITERAL:c.type=u.STRING_LITERAL,c.isStringLiteral=!0,c.val=a.toString();break;case u.DATE:D(a)&&(c.type=u.DATE,c.isDate=!0);break;case u.ARRAY:E(a)||(c.val=[a]),c.type=u.ARRAY,c.isArray=!0;break;case u.REGEX:F(a)||(c.val=d.Regex(a)),c.type=u.REGEX,c.isRegex=!0;break;case u.COMMA:c.type=u.COMMA,c.isComma=!0,c.val=",";break;case u.LEFT_PAREN:c.type=u.LEFT_PAREN,c.isLeftParen=!0,c.isParen=!0,c.val="(";break;case u.RIGHT_PAREN:c.type=u.RIGHT_PAREN,c.isRightParen=!0,c.isParen=!0,c.val=")";break;case u.ARG_TERMINAL:c.type=u.ARG_TERMINAL,c.isArgTerminal=!0,c.val=p;break;case u.UNARY_NEGATIVE:c.type=u.UNARY_NEGATIVE,c.isUnaryNegative=!0,c.val=n,c.isArithmeticOp=!0,c.isOp=!0;break;case u.UNARY_NEGATION:c.type=u.UNARY_NEGATION,c.isUnaryNegation=!0,c.val=o,c.isLogicOp=!0,c.isOp=!0;break;case u.NUMBER:c.type=u.NUMBER,c.isNumber=!0,e=="string"?c.val=new Number(a):e=="number"?c.val=a:e=="boolean"?c.val=a==1?1:0:e=="object"&&(c.val=new Number(a.toString()));break;case u.BOOLEAN:c.type=u.BOOLEAN,c.isBoolean=!0,e=="boolean"?c.val=a:e=="string"?c.val=a.toUpperCase()=="TRUE"?!0:!1:e=="number"?c.val=a!=0?!0:!1:Object.prototype.toString.call(a)==="[object Number]"?c.val=a.valueOf()!=0?!0:!1:e=="object"&&(c.val=a.toString().toUpperCase()=="TRUE"?!0:!1);break;case u.VARIABLE:c.type=u.VARIABLE,c.isVariable=!0;break;case u.__DEFAULT__:default:e=="object"&&(a instanceof String||Object.prototype.toString.call(a)==="[object String]")&&a._isStringLiteral?(c.type=u.STRING_LITERAL,c.isStringLiteral=!0,c.val=a.toString()):D(a)?(c.type=u.DATE,c.isDate=!0):E(a)?(c.type=u.ARRAY,c.isArray=!0):F(a)?(c.type=u.REGEX,c.isRegex=!0):a==","?(c.type=u.COMMA,c.isComma=!0,c.val=","):a=="("?(c.type=u.LEFT_PAREN,c.isLeftParen=!0,c.isParen=!0,c.val="(",c.isOp=!0):a==")"?(c.type=u.RIGHT_PAREN,c.isRightParen=!0,c.isParen=!0,c.val=")"):G(a)?(c.type=u.NUMBER,c.isNumber=!0,e=="string"?c.val=(new Number(a)).valueOf():e=="number"?c.val=a:e=="boolean"?c.val=a==1?1:0:e=="object"&&(c.val=(new Number(a.toString())).valueOf())):H(a)?(c.type=u.BOOLEAN,c.isBoolean=!0,e=="boolean"?c.val=a:e=="string"?c.val=a.toUpperCase()=="TRUE"?!0:!1:e=="number"?c.val=a!=0?!0:!1:Object.prototype.toString.call(a)==="[object Number]"?c.val=a.valueOf()!=0?!0:!1:e=="object"&&(c.val=a.toString().toUpperCase()=="TRUE"?!0:!1)):y(a)?(c.type=u.ARITHMETIC_OP,c.isArithmeticOp=!0,c.isOp=!0):z(a)?(c.type=u.LOGICAL_OP,c.isLogicOp=!0,c.isOp=!0):A(a)?(c.type=u.COMPARISON_OP,c.isCompOp=!0,c.isOp=!0):B(a)?(c.type=u.FUNCTION,c.isFunction=!0,c.val=a):C(a)&&(c.type=u.VARIABLE,c.isVariable=!0)}if(c.isOp||c.isFunction){var f=0;switch(c.val){case"+":case"-":f=50;break;case"*":case"/":case"%":f=60;break;case"^":f=70;break;case n:case o:case"!":case"NOT":f=100;break;case"(":f=1e3;break;case"AND":case"&":f=35;break;case"OR":case"|":f=30;break;case">":case">=":case"<":case"<=":case"=":case"<>":case"gt":case"gte":case"lt":case"lte":case"eq":case"ne":f=40;break;default:c.isFunction?f=500:f=0}c.precedence=f}else c.precedence=0;return c},N=M("",u.EMPTY_TOKEN),O=M("",u.STRING_LITERAL);return{makeToken:M,cloneToken:function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(D(a[c])?b[c]=new Date(a[c].getTime()):b[c]=a[c]);return b},TOKEN_TYPE:u,EMPTY_TOKEN:N,EMPTY_STRING:O,UNARY_NEGATIVE:M(n,u.UNARY_NEGATIVE),UNARY_NEGATION:M(o,u.UNARY_NEGATION),ARG_TERMINAL:M(p,u.ARG_TERMINAL),isBoolean:H,isNumber:G,isString:function(a){if(!v(a))return!1;var b=typeof a;return G(a)||H(a)||E(a)||D(a)||F(a)?!1:b=="string"||b=="object"&&(a instanceof String||Object.prototype.toString.call(a)==="[object String]")?!0:!1},isDateInstance:D,isArrayInstance:E,isRegExpInstance:F,isDate:function(b,c,d){return v(b)?D(b)?(typeof d!="undefined"&&(d.date=b),!0):a.isDate(b,c,d):!1},toArray:function(a){return E(a)?a:[a]},toNumber:function(a){var b=Number.NaN;return typeof a=="number"?a:(b=new Number(a),b.valueOf())},toBoolean:function(a){var b=Number.NaN,c=null;if(a==null||a==undefined)throw"Boolean value is not defined!";return typeof a=="boolean"?a:typeof a=="number"?a!=0:G(a)?(b=g.toNumber(a),isNaN(b)?null:b!=0):typeof a=="object"?(c=a.toString(),c.toUpperCase()=="TRUE"?!0:c.toUpperCase()=="FALSE"?!1:null):typeof a=="string"?a.toUpperCase()=="TRUE"?!0:a.toUpperCase()=="FALSE"?!1:null:null},Tokanize:function(a){var b,c,d,e,f,g,h,i,j;L(),b=0,c=0,intBrackets=0,e=0,i="",d=new Array,a=K(a);while(b<a.length){j=N,g=a.substr(b,1);switch(g){case" ":i.length>0&&(d[e]=M(i),e++,i="");break;case"(":c++,i.length>0&&(d[e]=M(i),e++,i=""),d[e]=M(g),e++;break;case")":c--,i.length>0&&(d[e]=M(i),e++,i=""),d[e]=M(g),e++;break;case"^":case"*":case"/":case"%":case"&":case"|":case",":case"!":i.length>0&&(d[e]=M(i),e++,i=""),d[e]=M(g),e++;break;case"-":i.length>0&&(d[e]=M(i),e++,i=""),h=a.substr(b+1,1),d.length>0&&(j=d[e-1]),(j.isArithmeticOp||j.isLeftParen||j.isComma)&&(w(h)||h=="(")?i+=g:(d[e]=M(g),e++,i="");break;case"+":i.length>0&&(d[e]=M(i),e++,i=""),h=a.substr(b+1,1),d.length>0&&(j=d[e-1]),(j.isArithmeticOp||j.isLeftParen||j.isComma)&&(w(h)||h=="(")?i+=g:(d[e]=M(g),e++,i="");break;case"<":h=a.substr(b+1,1),i.length>0&&(d[e]=M(i),e++,i=""),h=="="?(d[e]=M(g+"="),e++,b++):h==">"?(d[e]=M(g+">"),e++,b++):(d[e]=M(g),e++);break;case">":h=a.substr(b+1,1),i.length>0&&(d[e]=M(i),e++,i=""),h=="="?(d[e]=M(g+"="),e++,b++):(d[e]=M(g),e++);break;case"=":i.length>0&&(d[e]=M(i),e++,i=""),d[e]=M(g),e++;break;case"'":case'"':i.length>0&&(d[e]=M(i),e++,i=""),f=a.indexOf(g,b+1);if(f<0)throw"Unterminated string constant";i+=a.substring(b+1,f),i=new String(i),i._isStringLiteral=!0,d[e]=M(i),e++,i="",b=f;break;default:i+=g}b++}if(c>0)throw"Unbalanced parenthesis!";return i.length>0&&(d[e]=M(i)),d}}}(e);return function(a,b){return{setParams:function(a){d.setParams(a)},Expression:function(c){function n(c,d){typeof d=="undefined"&&(d=g);if(d==null||d==undefined)d=new Array;varName=c.name,varToken=null;if(c.withType)switch(c.withType){case"boolean":varToken=a.makeToken(c.val,a.TOKEN_TYPE.BOOLEAN);break;case"number":varToken=a.makeToken(c.val,a.TOKEN_TYPE.NUMBER);break;case"array":varToken=a.makeToken(c.val,a.TOKEN_TYPE.ARRAY);break;case"date":var e;c.format?e=c.format:e=l,varToken=a.makeToken(b.parseDate(c.val,e),a.TOKEN_TYPE.DATE);break;case"string":default:varToken=a.makeToken(c.val,a.TOKEN_TYPE.STRING_LITERAL)}else varToken=a.makeToken(c.val,a.TOKEN_TYPE.STRING_LITERAL);d[varName]=varToken}function o(a){var b="";for(var c=0;c<a.length;c++)b+=a[c].val+",";return b}function p(b){var c=new Array(b.length);for(var d=0;d<b.length;d++)c[d]=a.cloneToken(b[d]);return c}function q(a){return function(b){var c=[];if(typeof b!="undefined"&&b)for(var d=0;d<b.length;d++)n(b[d],c);return u(p(a),c)}}function r(b){var c=a.Tokanize(b);if(c==null||c==undefined)throw"Unable to tokanize the expression!";if(c.length<=0)throw"Unable to tokanize the expression!";var d=i(c);if(d==null||d==undefined)throw"Unable to convert the expression to postfix form!";if(d.length<=0)throw"Unable to convert the expression to postfix form!";return q(d)}function s(){j=a.Tokanize(e);if(j==null||j==undefined)throw"Unable to tokanize the expression!";if(j.length<=0)throw"Unable to tokanize the expression!";var b=i(j);if(b==null||b==undefined)throw"Unable to convert the expression to postfix form!";if(b.length<=0)throw"Unable to convert the expression to postfix form!";return b}function t(a,b){var c;typeof b=="undefined"&&(b=g);if(b==null||b==undefined)throw"Variable values are not supplied!";c=b[a];if(typeof b[a]=="undefined"||c==undefined||c==null)throw"Variable ["+a+"] not defined";return c}function u(b,c){var e,g,i,j,k,m,n,o,p,q,r;if(b==null||b==undefined)b=s();if(b.length==0)throw"Unable to parse the expression!";if(b==null||b==undefined||b.length==0)throw"Invalid postfix expression!";e=0,g=new f;while(e<b.length){i=b[e];switch(i.type){case a.TOKEN_TYPE.ARG_TERMINAL:g.Push(i);break;case a.TOKEN_TYPE.UNARY_NEGATIVE:if(g.IsEmpty())throw"No operand to negate!";k=null,m=null,k=g.Pop(),k.isVariable&&(k=t(k.val,c)),p=a.toNumber(k.val);if(isNaN(p))throw"Not a numeric value!";p=0-p,g.Push(a.makeToken(p,a.TOKEN_TYPE.NUMBER));break;case a.TOKEN_TYPE.UNARY_NEGATION:if(g.IsEmpty())throw"No operand on stack!";k=null,m=null,k=g.Pop(),k.isVariable&&(k=t(k.val,c)),k=a.toBoolean(k.val);if(k==null)throw i.val+" applied not on a boolean value!";g.Push(a.makeToken(!k,a.TOKEN_TYPE.BOOLEAN));break;case a.TOKEN_TYPE.ARITHMETIC_OP:switch(i.val){case"*":case"/":case"%":case"^":if(g.IsEmpty()||g.Size()<2)throw"Stack is empty, can not perform ["+i.val+"]";k=null,m=null,objTmp=null,m=g.Pop(),k=g.Pop(),k.isVariable&&(k=t(k.val,c)),m.isVariable&&(m=t(m.val,c));if(!k.iNumber||!m.isNumber)throw"Either one of the operand is not a number can not perform ["+i.val+"]";q=a.toNumber(k.val),r=a.toNumber(m.val);if(isNaN(q)||isNaN(r))throw"Either one of the operand is not a number can not perform ["+i.val+"]";i.val=="^"?g.Push(a.makeToken(Math.pow(q,r),a.TOKEN_TYPE.NUMBER)):i.val=="*"?g.Push(a.makeToken(q*r,a.TOKEN_TYPE.NUMBER)):i.val=="/"?g.Push(a.makeToken(q/r,a.TOKEN_TYPE.NUMBER)):g.Push(a.makeToken(q%r,a.TOKEN_TYPE.NUMBER));break;case"+":case"-":if(g.IsEmpty()||g.Size()<2)throw"Stack is empty, can not perform ["+i.val+"]";k=null,m=null,n=null,o=null,j=i.val=="+"?"Addition":"Substraction",m=g.Pop(),k=g.Pop(),k.isVariable&&(k=t(k.val,c)),m.isVariable&&(m=t(m.val,c));if(k.isNumber&&m.isNumber)q=a.toNumber(k.val),r=a.toNumber(m.val),i.val=="+"?g.Push(a.makeToken(q+r,a.TOKEN_TYPE.NUMBER)):g.Push(a.makeToken(q-r,a.TOKEN_TYPE.NUMBER));else{if(!k.isStringLiteral||!m.isStringLiteral)throw j+" not supported for other types than numbers and strings!";if(i.val=="+")g.Push(a.makeToken(k.val+m.val,a.TOKEN_TYPE.STRING_LITERAL));else throw j+" not supported for strings!"}}break;case a.TOKEN_TYPE.COMPARISON_OP:switch(i.val){case"=":case"<":case">":case"<>":case"<=":case">=":case"eq":case"lt":case"gt":case"ne":case"lte":case"gte":if(g.IsEmpty()||g.Size()<2)throw"Stack is empty, can not perform ["+i.val+"]";k=null,m=null,n=null,o=null,m=g.Pop(),k=g.Pop(),k.isVariable&&(k=t(k.val,c)),m.isVariable&&(m=t(m.val,c));if(k.isNumber&&m.isNumber)q=a.toNumber(k.val),r=a.toNumber(m.val);else if(k.isNumber&&m.isBoolean)q=a.toNumber(k.val),r=a.toNumber(m.val);else if(m.isNumber&&k.isBoolean)q=a.toNumber(k.val),r=a.toNumber(m.val);else if(k.isDate&&m.isDate)q=k.val.getTime(),r=m.val.getTime();else if(k.isStringLiteral&&m.isStringLiteral)q=k.val.toString(),r=m.val.toString();else{if(!k.isBoolean||!m.isBoolean){if((i.val=="="||i.val=="<>"||i.val=="eq"||i.val=="ne")&&k.isStringLiteral&&m.isRegex){i.val=="="||i.val=="eq"?g.Push(a.makeToken(m.val.test(k.val.toString()),a.TOKEN_TYPE.BOOLEAN)):g.Push(a.makeToken(!m.val.test(k.val.toString()),a.TOKEN_TYPE.BOOLEAN));break}if((i.val=="="||i.val=="<>"||i.val=="eq"||i.val=="ne")&&m.isStringLiteral&&k.isRegex){i.val=="="||i.val=="eq"?g.Push(a.makeToken(k.val.test(m.val.toString()),a.TOKEN_TYPE.BOOLEAN)):g.Push(a.makeToken(!k.val.test(m.val.toString()),a.TOKEN_TYPE.BOOLEAN));break}if(i.val!="="&&i.val!="<>"&&i.val!="eq"&&i.val!="ne"||!k.isArray||!m.isStringLiteral&&!m.isNumber){if(i.val!="="&&i.val!="<>"&&i.val!="eq"&&i.val!="ne"||!m.isArray||!k.isStringLiteral&&!k.isNumber)throw"For "+i.val+" operator LHS & RHS should be of same data type!";i.val=="="||i.val=="eq"?g.Push(a.makeToken(d.Contains(m.val,k.val),a.TOKEN_TYPE.BOOLEAN)):g.Push(a.makeToken(!d.Contains(m.val,k.val),a.TOKEN_TYPE.BOOLEAN));break}i.val=="="||i.val=="eq"?g.Push(a.makeToken(d.Contains(k.val,m.val),a.TOKEN_TYPE.BOOLEAN)):g.Push(a.makeToken(!d.Contains(k.val,m.val),a.TOKEN_TYPE.BOOLEAN));break}if(i.val=="="||i.val=="<>"||i.val=="eq"||i.val=="ne")q=a.toBoolean(k.val),r=a.toBoolean(m.val);else throw i.val+" not supported for boolean values!"}i.val=="="||i.val=="eq"?g.Push(a.makeToken(q==r,a.TOKEN_TYPE.BOOLEAN)):i.val=="<>"||i.val=="ne"?g.Push(a.makeToken(q!=r,a.TOKEN_TYPE.BOOLEAN)):i.val==">"||i.val=="gt"?g.Push(a.makeToken(q>r,a.TOKEN_TYPE.BOOLEAN)):i.val=="<"||i.val=="lt"?g.Push(a.makeToken(q<r,a.TOKEN_TYPE.BOOLEAN)):i.val=="<="||i.val=="lte"?g.Push(a.makeToken(q<=r,a.TOKEN_TYPE.BOOLEAN)):(i.val==">="||i.val=="gte")&&g.Push(a.makeToken(q>=r,a.TOKEN_TYPE.BOOLEAN))}break;case a.TOKEN_TYPE.LOGICAL_OP:switch(i.val){case"NOT":case"!":if(g.IsEmpty())throw"No operand on stack!";k=null,m=null,k=g.Pop(),k.isVariable&&(k=t(k.val,c)),k=a.toBoolean(k.val);if(k==null)throw i.val+" applied not on a boolean value!";g.Push(a.makeToken(!k,a.TOKEN_TYPE.BOOLEAN));break;case"AND":case"&":case"OR":case"|":if(g.IsEmpty()||g.Size()<2)throw"Stack is empty, can not perform ["+i.val+"]";k=null,m=null,n=null,o=null,m=g.Pop(),k=g.Pop(),k.isVariable&&(k=t(k.val,c)),m.isVariable&&(m=t(m.val,c));if(k.isBoolean&&m.isBoolean||k.isNumber&&m.isNumber||k.isNumber&&m.isBoolean||k.isBoolean&&m.isNumber)n=a.toBoolean(k.val),o=a.toBoolean(m.val),i.val=="AND"||i.val=="&"?g.Push(a.makeToken(n&&o,a.TOKEN_TYPE.BOOLEAN)):(i.val=="OR"||i.val=="|")&&g.Push(a.makeToken(n||o,a.TOKEN_TYPE.BOOLEAN));else throw"Logical operator requires LHS & RHS of boolean type!"}break;case a.TOKEN_TYPE.FUNCTION:h(i,g,l,c);break;default:g.Push(i)}e++}if(g.IsEmpty()||g.Size()>1||g.Get(0).isVariable)throw"Unable to evaluate expression!";return g.Pop().val}var e=null,g=[],j=null,k=null,l="d/m/Y",m=this;typeof c!="undefined"&&c&&(e=c),this.dateLocales=function(a,c,d){return b.setDateLocaleStrings(a,c,d),m},this.dateFormat=function(a){return l=a,m},this.expression=function(a){return e=a,j=k=null,m},this.addVar=function(a){return n(a,g),m},this.parse=function(){return k=s(),o(k)},this.eval=function(){return u(k,g)},this.reset=function(){return g=[],e=j=k=null,m},this.dump=function(){return o(k)},this.preCompile=function(a){return typeof a=="undefined"&&(a=e),r(a)}}}}(g,e)}(a)})(window)

/**************************************************************************************************
*   Main Script
**************************************************************************************************/
/**
 *  MyZebra_Form (original is Zebra_Form)
 *
 *  Client-side validation for MyZebra_Form
 *
 *  Visit {@link http://stefangabos.ro/php-libraries/zebra-form/} for more information.
 *
 *  For more resources visit {@link http://stefangabos.ro/}
 *
 *  @author     Stefan Gabos <contact@stefangabos.ro>
 *  @version    2.8.5 (last revision: July 23, 2012)
 *  @copyright  (c) 2011 - 2012 Stefan Gabos
 *  @license    http://www.gnu.org/licenses/lgpl-3.0.txt GNU LESSER GENERAL PUBLIC LICENSE
 *  @package    MyZebra_Form
 */
/**
*
*   Edited, Augmented and Modified by Nikos M. (nikos.m@icanlocalize.com)
*
**/
 

;(function(a){a.MyZebra_Form_Taxonomy=function(b,c){c=a.extend({remove_text:"",auto_suggest:!1,ajax_url:""},c);var d=function(a){return a.replace(/[^\w \d\-_]|[\f\n\r\t\v\u00A0\u2028\u2029]+/g,"")},e=b,f=e.children(".myzebra-taxonomy-addremove").eq(0),g=f.attr("name"),h=function(){var a=f.val().match(/^add\{(.*?)\}remove\{(.*?)\}$/i),b=a[1].split(","),c=a[2].split(",");if(b==""||b[0]==""||!b.length)b=[];if(c==""||c[0]==""||!c.length)c=[];return{add:b,remove:c}},i=function(a,b){f.val("add{"+a.join(",")+"}remove{"+b.join(",")+"}")},j=function(){var b=[];return o.find(".myzebra-term").each(function(){b.push(a(this).text())}),b},k=function(b,f,g){b=a.trim(b);if(b=="")return;var j=h(),k=b.split(",");for(var l=0;l<k.length;l++){var m=!0;k[l]=d(k[l]);if(k[l]=="")continue;var n=a.inArray(k[l],j.remove);n>-1&&(j.remove.splice(n,1),m=!1);if(o.find(".myzebra-term").filter(function(){return a(this).text()==k[l]?!0:!1}).length)continue;!g&&m&&j.add.push(k[l]);var p=a('<div class="myzebra-term-wrapper"><a class="myzebra-term-remove" href="javascript:void(0);" title="'+c.remove_text+'"></a><span class="myzebra-term">'+k[l]+"</span></div>");f?p.appendTo(o).hide().fadeIn("slow"):p.appendTo(o)}g||e.trigger("taxonomy.change"),k=null,i(j.add,j.remove)},l=function(b,c,f){var g=b.parent(".myzebra-term-wrapper"),j=g.children(".myzebra-term").eq(0).text(),k=h();j=d(j);var l=a.inArray(j,k.add),m=!0;l>-1&&(k.add.splice(l,1),m=!1),j!=""&&a.inArray(j,k.remove)==-1&&m&&!f&&k.remove.push(j),i(k.add,k.remove),c?g.fadeOut("slow",function(){a(this).remove(),f||e.trigger("taxonomy.change")}):(g.remove(),f||e.trigger("taxonomy.change"))},m=e.children(".myzebra-text").eq(0),n=e.parent("form"),o=e.find(".myzebra-terms").eq(0);m.keyup(function(b){if(13==b.which)return k(a.trim(jQuery(this).val()),!0,!1),a(this).val(""),!1}).keypress(function(a){if(13==a.which)return a.preventDefault(),!1}),c.auto_suggest&&m.suggest(c.ajax_url+"?action=cred-ajax-tag-search&tax="+g,{delay:500,minchars:2,multiple:!0,multipleSep:", ",resultsClass:"myzebra-ac_results",selectClass:"myzebra-ac_over",matchClass:"myzebra-ac_match"}),e.on("click",".myzebra-terms a.myzebra-term-remove",function(){l(a(this),!0,!1)}),e.children(".myzebra-add-new-term").click(function(){var b=a.trim(m.val());if(b=="")return!1;k(b,!0,!1),m.val("")});var p=h(),q=0;while(q<p.add.length){var r=a.inArray(p.add[q],p.remove);r>-1&&p.remove.splice(r,1),o.find(".myzebra-term").filter(function(){return a(this).text()==p.add[q]?!0:!1}).length>0?(p.add.splice(q,1),q=0):q++}var q=0;while(q<p.remove.length)o.find(".myzebra-term").filter(function(){if(a(this).text()==p.remove[q])return true;else return false}).length==0?(p.remove.splice(q,1),q=0):q++;i(p.add,p.remove);var s=a.trim(m.val());s!=""&&k(s,!1,!1),m.val(""),k(h().add.join(","),!1,!0);var t=h().remove;for(var q=0;q<t.length;q++)o.find(".myzebra-term").filter(function(){return a(this).text()==t[q]?!0:!1}).each(function(){l(a(this),!1,!0)});e.data("addTerm",function(a){k(a,!0,!1)}),e.data("getTerms",function(){return j()})},a.fn.MyZebra_Form_Taxonomy=function(b){return this.each(function(){a.MyZebra_Form_Taxonomy(a(this),b)})},a.MyZebra_Form_TaxonomyPopular=function(b,c){c=a.extend({mastercontrol:null,show_popular_text:"",hide_popular_text:""},c);var d=c.mastercontrol,e=b,f=e.find(".myzebra-terms-popular").eq(0);f.find(".myzebra-term-popular").click(function(){d.data("addTerm")(jQuery(this).text())}),e.find(".myzebra-show-hide-popular").click(function(){f.is(":visible")?(f.hide(),a(this).text(c.show_popular_text)):(f.show(),a(this).text(c.hide_popular_text))}),f.hide()},a.fn.MyZebra_Form_TaxonomyPopular=function(b){return this.each(function(){a.MyZebra_Form_TaxonomyPopular(a(this),b)})},a.MyZebra_Form_TaxonomyHierarchical=function(b,c){var d=a(b),e=d.find(".myzebra-taxonomy-hierarchical"),f,g;f=e.find(".myzebra-taxonomy-hierarchical-select-container"),g=e.find(".myzebra-taxonomy-hierarchical-checkbox-container");var h=function(){var b=[];return f.length?f.find("select option:selected").each(function(){b.push(a(this).text())}):g.length&&g.find('input[type="checkbox"]:checked').each(function(){b.push(a(this).siblings(".myzebra-checkbox-label-span").text())}),b};d.data("getTerms",function(){return h()}),f.length?f.find("select").change(function(a){a.stopPropagation(),d.trigger("taxonomy.change")}):g.length&&g.on("change",'input[type="checkbox"]',function(a){a.stopPropagation(),d.trigger("taxonomy.change")})},a.fn.MyZebra_Form_TaxonomyHierarchical=function(b){return this.each(function(){a.MyZebra_Form_TaxonomyHierarchical(a(this),b)})},a.MyZebra_Form_TaxonomyHierarchicalAddNew=function(b,c){var d=b,e=c.mastercontrol.find(".myzebra-taxonomy-hierarchical"),f=c.mastercontrol.attr("id"),g=e.find("#"+f+"_hierarchy"),h=e.find("#"+f+"_chosen").val().split(",")||[],i=d.find("select"),j,k,l=d.find(".myzebra-add-text"),m=d.find(".myzebra-add-new-term");d.find(".myzebra-add-new-hierarchical-terms").hide(),d.find(".myzebra-add-new-hierarchical").click(function(){a(this).hasClass("myzebra-add-new-hierarchical-open")?(a(this).removeClass("myzebra-add-new-hierarchical-open"),d.find(".myzebra-add-new-hierarchical-terms").hide()):(a(this).addClass("myzebra-add-new-hierarchical-open"),d.find(".myzebra-add-new-hierarchical-terms").show(),j=e.find(".myzebra-taxonomy-hierarchical-select-container"),k=e.find(".myzebra-taxonomy-hierarchical-checkbox-container"),i.empty(),i.append('<option value="-1">'+c.parent_text+"</option>"),j.length?j.find("select option").each(function(){i.append(jQuery(this).clone())}):k.length&&k.find('input[type="checkbox"]').each(function(){i.append('<option value="'+jQuery(this).val()+'">'+jQuery(this).closest(".myzebra-taxonomy-hierarchical-checkbox").find(".myzebra-checkbox-label-span").eq(0).text()+"</option>")}))});var n=function(){var b=a.trim(l.val().replace(/[^\w\- ]+/g,""));if(b=="")return!1;var f=i.val();if(j.length)j.find("select").prepend('<option value="'+b+'" selected="selected">'+b+"</option>");else if(k.length){var h=e.find(".myzebra-taxonomy-hierarchical-name-parameter").text(),m=a("<div style='position:relative;line-height:0.9em;margin:2px 0;margin-left:15px;' class='myzebra-taxonomy-hierarchical-checkbox'><label class='myzebra-style-label'><input type='checkbox' class='myzebra-control myzebra-checkbox' name='"+h+"' value='"+b+"' checked='checked' /><span class='myzebra-checkbox-replace'></span><span class='myzebra-checkbox-label-span'  style='position:relative;font-size:12px;display:inline-block;margin:0;padding:0;margin-left:15px;'>"+b+"</span></label></div>");k.prepend(m)}return l.val(""),g.val(g.val()+"{"+f+","+b+"}"),d.find(".myzebra-add-new-hierarchical").removeClass("myzebra-add-new-hierarchical-open"),d.find(".myzebra-add-new-hierarchical-terms").hide(),c.mastercontrol.trigger("taxonomy.change"),!1};m.click(n),l.keyup(function(a){if(13==a.which)return n(),!1}).keypress(function(a){if(13==a.which)return a.preventDefault(),!1});if(g.val()!=""){j=e.find(".myzebra-taxonomy-hierarchical-select-container"),k=e.find(".myzebra-taxonomy-hierarchical-checkbox-container");var o=g.val().match(/\{[^\{\},]+,[^\{\},]+\}/g);for(var p=0;p<o.length;p++){var q=o[p].replace(/\{|\}/g,""),r=q.split(",");if(j.length)a.inArray(r[1],h)!=-1?j.find("select").prepend('<option value="'+r[1]+'" selected="selected">'+r[1]+"</option>"):j.find("select").prepend('<option value="'+r[1]+'">'+r[1]+"</option>");else if(k.length){var s=e.find(".myzebra-taxonomy-hierarchical-name-parameter").text();if(a.inArray(r[1],h)!=-1)var t=a("<div style='position:relative;line-height:0.9em;margin:2px 0;margin-left:15px;' class='myzebra-taxonomy-hierarchical-checkbox'><input type='checkbox' class='myzebra-control myzebra-checkbox' name='"+s+"' value='"+r[1]+"' checked='checked' /><span class='myzebra-checkbox-label-span'  style='position:relative;font-size:12px;display:inline-block;margin:0;padding:0;margin-left:15px;'>"+r[1]+"</span></div>");else var t=a("<div style='position:relative;line-height:0.9em;margin:2px 0;margin-left:15px;' class='myzebra-taxonomy-hierarchical-checkbox'><input type='checkbox' class='myzebra-control myzebra-checkbox' name='"+s+"' value='"+r[1]+"' /><span class='myzebra-checkbox-label-span'  style='position:relative;font-size:12px;display:inline-block;margin:0;padding:0;margin-left:15px;'>"+r[1]+"</span></div>");k.prepend(t)}}}},a.fn.MyZebra_Form_TaxonomyHierarchicalAddNew=function(b){return this.each(function(){a.MyZebra_Form_TaxonomyHierarchicalAddNew(a(this),b)})},a.fn.fadeToggle=function(b,c,d){return c=c||"linear",this.each(function(){a(this).animate({opacity:"toggle"},b,c,function(){jQuery.browser.msie&&this.style.removeAttribute("filter"),jQuery.isFunction(d)&&d()})})},a.fn.slideFadeToggle=function(b,c,d){return c=c||"linear",this.each(function(){a(this).animate({opacity:"toggle",height:"toggle"},b,c,function(){jQuery.browser.msie&&this.style.removeAttribute("filter"),jQuery.isFunction(d)&&d()})})},a.fn.slideFadeDown=function(b,c,d){return c=c||"linear",this.each(function(){a(this).animate({opacity:"show",height:"show"},b,c,function(){jQuery.browser.msie&&this.style.removeAttribute("filter"),jQuery.isFunction(d)&&d()})})},a.fn.slideFadeUp=function(b,c,d){return c=c||"linear",this.each(function(){a(this).animate({opacity:"hide",height:"hide"},b,c,function(){jQuery.browser.msie&&this.style.removeAttribute("filter"),jQuery.isFunction(d)&&d()})})},function(a){function b(b,c){var d=c.editor;d.hidePopups(),c.popup&&a(c.popup).remove();var e=d.$area.closest("form").find('input[name="'+myzebra.PREFIX+"post_id"+'"]');if(!e.length)return;var f=e.val();return window.send_to_editor=function(a){d.execCommand(c.command,a,null,c.button),tb_remove(),d.focus()},tb_show("Insert Media",myzebra.insertMediaPopupURL+"?post_id="+f+"&amp;type=image&amp;TB_iframe=true"),!1}a.cleditor.buttons.insertMedia={name:"insertMedia",css:{background:"url("+myzebra.insertMediaIconURL+") no-repeat center center"},title:"Insert Media",command:"inserthtml",popupName:"insertMedia",popupClass:"cleditorPopup",popupContent:"",buttonClick:b},a.cleditor.buttons.source.buttonClick=function(a,b){var c=b.editor;if(c.disabled)return!0;var d=c.$area.closest(".myzebra-rich-editor-container").find(".myzebra-rich-editor-resize");return c.sourceMode()?d.show():d.hide(),!0}}(a),a.MyZebra_Form=function(b,c){var d=this,e=c.conditionals!==!1,f=c.conditionals,g={scroll_to_error:!0,tips_position:"left",close_tips:!0,validate_on_the_fly:!1,validate_all:!1,assets_path:null,myzebra_datepicker:{}},h={};d.settings={},d.editor_resize=null;var i=new Object,j=new Object,k=new Object,l=new Array,m=!1;d.remove_field_action=function(b){b=a(b);var c=b.closest(".myzebra-repeatable-field"),e=c.find(".myzebra-control").eq(0),f=e.attr("id");a("#MyZebra_Form_error_message_"+f).remove(),a("#"+f+"_spinner").remove(),delete i[f],delete j[f],delete k[f],delete d.settings.error_messages[f],delete h[f],c.fadeOut("slow",function(){a(this).remove()})};var n=a(b),o=b;d.filter_input=function(a,b,c){var d,e,f,g="",h="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",i="0123456789";if(window.event)d=window.event.keyCode,b=window.event;else if(b)d=b.which;else return!0;switch(a){case"alphabet":g=h;break;case"digits":case"number":case"float":g=i;break;case"alphanumeric":g=h+i;break;default:return!0}return c&&(g+=c),f=b.srcElement?b.srcElement:b.target||b.currentTarget,d==null||d==0||d==8||d==9||d==13||d==27?!0:(e=String.fromCharCode(d),g.indexOf(e)>-1?!0:a=="number"&&e=="-"&&r(f)==0?!0:a=="float"&&(e=="-"&&r(f)==0||e=="."&&r(f)!=0&&f.value.match(/\./)==null)?!0:!1)},d.element_add=function(b){var c={id:b.attr("id"),type:v(b)},e=b.closest(".row");b.unbind("click focus blur change keypress"),b.hasClass("myzebra-date")&&!b.is("[readonly]")&&b.MyZebra_DatePicker(h[c.id]),e.length&&b.bind({focus:function(){e.addClass("myzebra-highlight")},blur:function(){e.removeClass("myzebra-highlight")}});if(!b.hasClass("myzebra-inner-label")||c["type"]!="text"&&c["type"]!="password"&&c["type"]!="textarea")b.hasClass("myzebra-other")&&c["type"]=="select-one"&&(u(b),b.change(function(){u(b)}));else{var f=b.position();if(c["type"]=="text"||c["type"]=="password")var g=jQuery("<input>").attr({type:"text","class":"MyZebra_Form_Placeholder",autocomplete:"off",value:b.attr("title")});else var g=jQuery("<textarea>").attr({"class":"MyZebra_Form_Placeholder",autocomplete:"off"}).html(b.attr("title"));g.css({display:"none",fontFamily:b.css("fontFamily"),fontSize:b.css("fontSize"),fontStyle:b.css("fontStyle"),fontWeight:b.css("fontWeight"),left:f.left,top:f.top,width:b.width()+(parseInt(b.css("borderLeftWidth"),10)||0)+(parseInt(b.css("borderRightWidth"),10)||0),height:b.height()+(parseInt(b.css("borderTopWidth"),10)||0)+(parseInt(b.css("borderBottomWidth"),10)||0),paddingTop:parseInt(b.css("paddingTop"),10)||0,paddingRight:parseInt(b.css("paddingRight"),10)||0,paddingBottom:parseInt(b.css("paddingBottom"),10)||0,paddingLeft:parseInt(b.css("paddingLeft"),10)||0}).insertAfter(b),b.removeAttr("title"),g.bind("focus",function(){b.focus()}),b.bind({focus:function(){g.css("display","none")},blur:function(){a(this).val()==""&&g.css("display","block")}}),b.data("MyZebra_Form_Placeholder",g),l.push(b)}undefined!=d.settings.error_messages&&undefined!=typeof d.settings.error_messages[c["id"]]&&d.register(b,!1);if((c["type"]=="text"||c["type"]=="textarea"||c["type"]=="password")&&b.attr("maxlength")){b.data("maxlength",b.attr("maxlength")),b.bind("keyup",function(b){var c=a(this),d=c.data("maxlength"),e=s(c);c.attr("maxlength",d-e);if(c.hasClass("myzebra-show-character-counter")){var f=d-e-c.val().length;i.html(f<0?"<span>"+f+"</span>":f)}});if(b.hasClass("myzebra-show-character-counter")){var f=b.position(),i=jQuery("<div>",{"class":"MyZebra_Character_Counter",css:{visibility:"hidden"}}).html(b.data("maxlength")).insertAfter(b);width=i.outerWidth(),height=i.outerHeight(),i.css({top:f.top+b.outerHeight()-height/1.5,left:f.left+b.outerWidth()-width/1.5,width:i.width(),visibility:"visible"}),b.trigger("keyup")}}},d.hideShowGroup=function(a,b,c){var d="slow",e=50;if(b){a.parents(".myzebra-conditional-group-hidden").length||a.find(".myzebra-control").not(".myzebra-file-disabled").removeAttr("disabled"),a.removeClass("myzebra-conditional-group-hidden").addClass("myzebra-conditional-group-visible");switch(c){case"fade-slide":setTimeout(function(){a.stop(!0).slideFadeDown(d,"quintEaseOut")},e);break;case"slide":setTimeout(function(){a.stop(!0).slideDown(d,"quintEaseOut")},e);break;case"fade":setTimeout(function(){a.stop(!0).fadeIn(d)},e);break;case"none":default:}}else{a.find(".myzebra-control").attr("disabled","disabled"),a.removeClass("myzebra-conditional-group-visible").addClass("myzebra-conditional-group-hidden");switch(c){case"fade-slide":setTimeout(function(){a.stop(!0).slideFadeUp(d,"quintEaseIn")},e);break;case"slide":setTimeout(function(){a.stop(!0).slideUp(d,"quintEaseIn")},e);break;case"fade":setTimeout(function(){a.stop(!0).fadeOut(d)},e);break;case"none":default:}}},d.getFieldVal=function(b,c){var d=null,e;return b.hasClass("myzebra-taxonomy")&&b.data("getTerms")?d=b.data("getTerms")():b.hasClass("myzebra-checkbox")?(d=[],b.filter(function(){return a(this).is(":checked")?(e=a(this).val(),c&&c[e]&&(e=c[e]),d.push(e),!0):!1})):b.hasClass("myzebra-select")?(d=[],b.find("option").filter(function(){return a(this).is(":selected")?(e=a(this).val(),c&&c[e]&&(e=c[e]),d.push(e),!0):!1})):b.hasClass("myzebra-radio")?b.filter(function(){return a(this).is(":checked")?(e=a(this).val(),c&&c[e]&&(e=c[e]),d=e,!0):!1}):d=b.eq(0).val(),d},d.runConditional=function(a){var b,c,a,e,f,g,h,i,j;e=[];if(a.map.length)for(f=0;f<a.map.length;f++)a.map[f].formfield||(a.map[f].formfield=n.find(".myzebra-prime-name-"+a.map[f].field_name),i=!0),g=a.map[f].formfield,h=d.getFieldVal(g,a.map[f].values_map),g.hasClass("myzebra-date")?e.push({name:a.map[f].variable,val:h,withType:"date",format:d.settings.myzebra_datepicker[a.map[f].field].format}):typeof h=="object"&&(h instanceof Array||Object.prototype.toString.call(h)=="[object Array]")?e.push({name:a.map[f].variable,val:h,withType:"array"}):e.push({name:a.map[f].variable,val:h,withType:"string"});if(!a.RESULT)try{b=a.parser(e)}catch(k){typeof k=="string"||k instanceof String?d.log("Parser Error: "+k):d.log("Parser Error: "+k.message),showeGroup=!1}else b=a.RESULT;return!a.map.length&&!a.RESULT&&(a.RESULT=b,i=!0),a.$group||(a.$group=n.find("#"+a.group),i=!0),(b&&!a.$group.hasClass("myzebra-conditional-group-visible")||!b&&!a.$group.hasClass("myzebra-conditional-group-hidden"))&&d.hideShowGroup(a.$group,b,a.mode),a},d.conditionalControl=function(){var b=a(this).data("_conditionalControl");if(!b)return;var c,e,f,g,h,i,j,k,l;k=!1;for(var m=0;m<b.length;m++){f=b[m],g=[];if(f.map.length)for(h=0;h<f.map.length;h++)f.map[h].formfield||(f.map[h].formfield=n.find(".myzebra-prime-name-"+f.map[h].field_name),k=!0),i=f.map[h].formfield,j=d.getFieldVal(i,f.map[h].values_map),i.hasClass("myzebra-date")?g.push({name:f.map[h].variable,val:j,withType:"date",format:d.settings.myzebra_datepicker[f.map[h].field].format}):typeof j=="object"&&(j instanceof Array||Object.prototype.toString.call(j)=="[object Array]")?g.push({name:f.map[h].variable,val:j,withType:"array"}):g.push({name:f.map[h].variable,val:j,withType:"string"});if(!f.RESULT)try{c=f.parser(g)}catch(o){typeof o=="string"||o instanceof String?d.log("Parser Error: "+o):d.log("Parser Error: "+o.message),showeGroup=!1}else c=f.RESULT;!f.map.length&&!f.RESULT&&(f.RESULT=c,k=!0),f.$group||(f.$group=n.find("#"+f.group),k=!0),(c&&!f.$group.hasClass("myzebra-conditional-group-visible")||!c&&!f.$group.hasClass("myzebra-conditional-group-hidden"))&&d.hideShowGroup(f.$group,c,f.mode),b[m]=f}k&&a(this).data("_conditionalControl",b)},d.log=function(a){window.console&&window.console.log&&window.console.log(a)},d.initConditionals=function(){if(e&&MyZebraParser){var a;myzebra.parser_info&&MyZebraParser.setParams(myzebra.parser_info);try{a=(new MyZebraParser.Expression).dateLocales(myzebra.days,myzebra.months)}catch(b){typeof b=="string"||b instanceof String?d.log("Init Parser Error: "+b):d.log("Init Parser Error: "+b.message);return}var c={};for(var g=0;g<f.groups.length;g++){var h=f.groups[g];h.parser=a.preCompile(h.condition);for(var i=0;i<h.affected_fields_names.length;i++){var j=h.affected_fields_names[i],k=n.find(".myzebra-prime-name-"+j);if(k.length){var l=k.data("_conditionalControl");l?l.push(h):l=[h],k.data("_conditionalControl",l),c[j]||(k.hasClass("myzebra-taxonomy")?k.bind("taxonomy.change",d.conditionalControl):k.bind("change",d.conditionalControl),c[j]=!0)}}}setTimeout(function(){for(var a=0;a<f.groups.length;a++){var b=f.groups[a];b=d.runConditional(b)}},100)}},d.init=function(){d.settings=a.extend({},g,c),h=d.settings.myzebra_datepicker,n.find("option.myzebra-dummy").remove(),a("div.myzebra-form-error",n).each(function(){a("div.myzebra-close a",a(this)).bind("click",function(b){b.preventDefault(),a(this).closest("div.myzebra-form-error").animate({height:0,opacity:0},250,function(){a(this).remove()})})}),a("div.myzebra-form-message",n).each(function(){a("div.myzebra-close a",a(this)).bind("click",function(b){b.preventDefault(),a(this).closest("div.myzebra-form-message").animate({height:0,opacity:0},250,function(){a(this).remove()})})});var b=a(".myzebra-control",n);b.each(function(){d.element_add(a(this))}),n.on("mousedown",".myzebra-rich-editor-resize",function(b){var c=a(this).closest(".myzebra-rich-editor-container"),e=c.find(".myzebra-wysiwyg");if(e.length){var f=e.data("editor");f&&!f.disabled&&(f.updateTextArea(),d.editor_resize={element:e,container:c,pX:b.pageX,pY:b.pageY,h:c.height(),w:c.width()})}return!1}),a(document).bind("mouseup",function(a){if(d.editor_resize&&d.editor_resize.element.length){var b=d.editor_resize.element.data("editor");b.updateFrame(),b.refresh(),d.editor_resize=null}d.editor_resize=null}),a(document).bind("mousemove",function(a){if(d.editor_resize&&d.editor_resize.container.length){var b=d.editor_resize.container;b.height(d.editor_resize.h-d.editor_resize.pY+a.pageY),b.width(d.editor_resize.w-d.editor_resize.pX+a.pageX)}}),n.find(".myzebra-add-new-field").bind("click",function(){var b=a(this).parent("div"),c=parseInt(b.attr("class").replace(/myzebra\-count_(\d+)/,"$1")),e=b.find(".myzebra-repeatable-field");if(b.find(".myzebra-skype-container").length){var f=e.eq(0).find(".myzebra-skype-container").eq(0),g=f.attr("id").replace(/_repeat_(\d+)/,""),i=f.find(".myzebra-control").eq(0),j=i.attr("id").replace(/_repeat_(\d+)/,""),k=f.find(".myzebra-hidden").eq(0),l=i.attr("name"),m=i.attr("name").replace(/\[[^\[\]]*\]$/,"["+c+"]"),n=k.attr("name").replace(/\[[^\[\]]*\]$/,"["+c+"]"),o=g+"_repeat_"+c,p,q;p=e.eq(0).clone(!0),p.find(".myzebra-validation-error").length>0&&(p.find(".myzebra-field-error-messages").remove(),p.find(".myzebra-validation-error").children(":eq(0)").unwrap()),q=p.find(".myzebra-control").eq(0),clone_element_hidden=p.find(".myzebra-hidden").eq(0),q.removeAttr("disabled"),q.removeClass("myzebra-file-disabled"),q.removeData(),q.attr("id",q.attr("id").replace(g,o)),clone_element_hidden.attr("id",clone_element_hidden.attr("id").replace(g,o)),clone_element_link=p.find(".myzebra-edit-skype").eq(0),clone_element_link.attr("href",clone_element_link.attr("href").replace(g,o)),q.attr("name",m),clone_element_hidden.attr("name",n),p.find(".myzebra-skype-container").attr("id",p.find(".myzebra-skype-container").attr("id").replace(g,o)),p.find(".myzebra-skype-preview-image-container").attr("id",p.find(".myzebra-skype-preview-image-container").attr("id").replace(g,o)),d.settings.error_messages[j]&&(d.settings.error_messages[q.attr("id")]=a.extend({},d.settings.error_messages[j])),b.append(p),d.element_add(q);var r=a("<a href='javascript:;' class='myzebra-remove-field'>"+myzebra.remove_repeatable_field+"</a>");r.insertAfter(q),r.unbind("click").bind("click",function(){d.remove_field_action(this)}),b.attr("class","myzebra-count_"+ ++c),p.hide().fadeIn("slow");return}var f=e.eq(0).find(".myzebra-control").eq(0),g=f.attr("id").replace(/_repeat_(\d+)/,""),l=f.attr("name").replace(/\[[^\[\]]*\]$/,"["+c+"]"),o=g+"_repeat_"+c,p,q,s={id:f.attr("id"),type:v(f)};p=e.eq(0).clone(!0),p.children(".myzebra-validation-error").length>0&&(p.find(".myzebra-field-error-messages").remove(),p.children(".myzebra-validation-error").children(":eq(0)").unwrap()),f.hasClass("myzebra-file")&&p.find('input[type="text"]').parent("div").remove(),f.hasClass("myzebra-date")&&p.find(".MyZebra_DatePicker_Icon").remove(),q=p.find(".myzebra-control").eq(0),q.removeAttr("disabled"),q.removeData(),q.attr("id",o),q.attr("name",l),q.val(""),q.attr("value",""),d.settings.error_messages[g]&&(d.settings.error_messages[o]=a.extend({},d.settings.error_messages[g])),s["type"]=="file"&&d.settings.error_messages[o].file_value&&delete d.settings.error_messages[o].file_value,q.hasClass("myzebra-date")&&(h[o]=a.extend({},h[g])),b.append(p),d.element_add(q),q=p.find(".myzebra-control").eq(0),q.css("visibility","visible").show();var r=a("<a href='javascript:;' class='myzebra-remove-field'>"+myzebra.remove_repeatable_field+"</a>");q.hasClass("myzebra-date")?r.insertAfter(q.parent(".myzebra-date-container")):r.insertAfter(q),r.unbind("click").bind("click",function(){d.remove_field_action(this)}),b.attr("class","myzebra-count_"+ ++c),p.hide().fadeIn("slow")}),n.find(".myzebra-remove-field").each(function(){var b=a(this),c=b.closest(".myzebra-repeatable-field"),e=c.find(".myzebra-control").eq(0),f=c.find(".myzebra-file-text").eq(0);f.length>0?b.remove().insertAfter(f):b.remove().insertAfter(e),b.unbind("click").bind("click",function(){d.remove_field_action(this)})}),a("body").on("submit","#"+n.attr("id"),function(a){m==0&&undefined!=d.settings.error_messages&&(d.validate()?undefined==a&&n.submit():(undefined!=a&&a.preventDefault(),d.show_errors()))}),l.length>0&&setInterval(p,100);var e=n.find(".myzebra-validation-error");e.length&&a("html").scrollTop(e.eq(0).offset().top-80),d.initConditionals()},d.attach_tip=function(a,b){var c=a.attr("id");i[c].message=b,d.show_errors(a)},d.clear_errors=function(){n.find(".MyZebra_Form_error_iFrameShim").remove(),n.find(".MyZebra_Form_error_message").remove(),k=[]},d.handle_file=function(c,d,e,f){typeof f=="undefined"&&(f=!1);var g=jQuery('<div class="myzebra-file-text"/>').insertAfter(c),h=jQuery("<input>",{id:c.attr("id")+"_text","class":c.attr("class"),style:"position:relative;",type:"text",name:c.attr("name"),value:e});g.append(h),f&&(c.attr("disabled","disabled"),c.hasClass("myzebra-file-disabled")||c.addClass("myzebra-file-disabled")),c.hide();var i=jQuery("<a>",{href:"javascript:void(0)","class":"myzebra-file-text-close",title:myzebra.cancel_upload_text}).unbind("click").bind("click",function(d){d.preventDefault(),g.remove(),c.val(""),c.data("file_info")&&c.removeData("file_info"),a("#"+c.attr("id")+"_spinner").remove(),c.css("visibility","visible").show(),c.removeAttr("disabled"),b.disabled=!1,!c.hasClass("myzebra-file-disabled")||c.removeClass("myzebra-file-disabled")});g.append(i)},d.end_file_upload=function(b,c){var e=a("#"+b);if(e.length){d.clear_errors(),n.removeAttr("target");var f=b;a("#"+f+"_iframe").remove(),a("#"+f+"_spinner").remove(),undefined!=i[b]&&(undefined!=c&&"object"==typeof c&&undefined!=c[0]&&undefined!=c[1]&&undefined!=c[2]&&undefined!=c[3]&&undefined!=c[4]&&undefined!=c[5]&&e.data("file_info",c),!0!==d.validate_control(e)?(e.val(""),e.css("visibility","visible"),d.show_errors(e)):d.handle_file(e,c,decodeURIComponent(i[e.attr("id")].rules.upload[1])+c[0],!1))}},d.hide_error=function(b){if(!b)return;var c=a("#"+b);if(c.length){var e={id:c.attr("id"),name:c.attr("name"),type:v(c)},f=e.name;e.name=e.name.replace(/\[[^\[\]]*\]$/,"")}if(undefined==arguments[1]&&d.settings.validate_on_the_fly&&!0!==d.validate_control(c))d.show_errors(c,!1);else{var g=b;c.length&&(e["type"]=="radio"||e["type"]=="checkbox")&&(g=e.name);var h=a("#MyZebra_Form_error_message_"+g);h.length>0&&h.animate({opacity:0},250,function(){var a=h.data("shim");undefined!=a&&a.remove(),h.remove(),delete k[b]})}},d.register=function(b){var c={id:b.attr("id"),name:b.attr("name"),type:v(b)},e=c.name;c.name=c.name.replace(/\[[^\[\]]*\]$/,""),b.is("select")&&!b.closest(".myzebra-keep-original").length&&!b.closest(".cred-keep-original").length&&b.dropkick();switch(c.type){case"radio":case"checkbox":b.bind({click:function(){d.hide_error(c.id)},blur:function(){d.hide_error(c.id)}}),undefined==j[c["id"]]&&(j[c.id]=n.find('input[name="'+e+'"]'));break;case"file":var f=b.clone(!0),g=d.settings.error_messages[b.attr("id")].file_value?d.settings.error_messages[b.attr("id")].file_value:"";f.attr("value",""),b.replaceWith(f),f.bind({keypress:function(a){a.preventDefault(),f.attr("value","")},change:function(){if(undefined!=i[c["id"]]["rules"]["upload"]){d.hide_error(c.id),f.data("file_info")&&f.removeData("file_info");var e=jQuery('<iframe id="'+c.id+"_iframe"+'" name="'+c.id+"_iframe"+'">',{src:"javascript:void(0)",scrolling:"no",marginwidth:0,marginheight:0,width:0,height:0,frameborder:0,allowTransparency:"true"});a("body").append(e);var g=n.attr("action"),h=b.attr("name").match(/\.*\[(\d+?)\]$/);h=h!=null?h[1]:0,n.attr("action",decodeURIComponent(d.settings.assets_path)+"process.php"+"?form="+n.attr("id")+"&control="+c.id+"&index="+(b.closest(".myzebra-repeatable-field").length>0?h:0)+"&controlname="+c.name+"&path="+encodeURIComponent(decodeURIComponent(i[c.id].rules.upload[0]))+"&url="+encodeURIComponent(decodeURIComponent(i[c.id].rules.upload[1]))+"&nocache="+(new Date).getTime()),n.attr("target",c.id+"_iframe"),b.css("visibility","hidden");var j=b.offset(),k=jQuery("<div>",{id:c.id+"_spinner","class":"MyZebra_Form_spinner",css:{left:j.left,top:j.top}});a("body").append(k),m=!0,n.trigger("submit"),n.attr("action",g),m=!1}},blur:function(){d.hide_error(c.id)}}),b=f,g!=""&&d.handle_file(b,null,g,!0);break;case"select-one":case"select-multiple":b.unbind("change blur").bind({change:function(){d.hide_error(c.id)},blur:function(){d.hide_error(c.id)}});break;default:b.unbind("blur").blur(function(){d.hide_error(c.id)})}var h=b.attr("class").match(/validate\[(.+)\]/);if(null!=h){var k=/([^\,]*\(.*?\)|[^\,]+)/g,l=new Object;while(matches=k.exec(h[1])){var o=matches[1].match(/^([^\(]+)/),p=matches[1].match(/\((.*?)\)/);p?(p=p[1].split(","),a.each(p,function(a){p[a]=p[a].replace(/lsqb\;/g,"["),p[a]=p[a].replace(/rsqb\;/g,"]"),p[a]=p[a].replace(/comma\;/g,","),p[a]=p[a].replace(/lsb\;/g,"("),p[a]=p[a].replace(/rsb\;/g,")")})):p=null,l[o[1]]=p}if(undefined==arguments[1]){var q=n.find(".myzebra-control");a.each(q,function(d,e){if(e==b.get(0)){var e=a(e),f=null,g=d-1;while(f==null&&undefined!=q[g])f=a(q[g]).attr("id"),g--;if(!i[f]){var h=new Object;h[c.id]={element:b,rules:l},a.extend(i,h)}else{var j=new Object;for(d in i)j[d]=i[d],f==d&&(j[c.id]={element:b,rules:l});i=j}}})}else if(undefined!=arguments[1]&&a("#"+arguments[1]).length){var r=a("#"+arguments[1]).attr("id"),s=new Object;for(index in i)s[index]=i[index],previous_element_id==index&&(s[c.id]={element:b,rules:l});i=s}else undefined!=arguments[1]&&arguments[1]===!1&&(i[c.id]={element:b,rules:l})}if(b.hasClass("myzebra-wysiwyg")){var t="bold italic underline strikethrough | bullets numbering style image link | cut copy paste pastetext | undo redo | source";b.hasClass("myzebra-has-media-button")&&(t="insertMedia "+t),""==a.trim(b.val())&&b.val("<p>&nbsp;</p>");var u=b.cleditor({width:"100%",height:"100%",controls:t,styles:[["Paragraph","<p>"],["Header 1","<h1>"],["Header 2","<h2>"],["Header 3","<h3>"],["Header 4","<h4>"],["Header 5","<h5>"],["Header 6","<h6>"]],useCSS:!1,docType:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">',docCSSFile:"",bodyStyle:"position:relative;"})[0];b.is("[readonly]")||b.hasClass("myzebra-disabled")?u.disable(!0):u.disable(!1),a.browser.msie||u.doc.execCommand("insertBrOnReturn",!1,!1),b.data("editor",u)}},d.show_errors=function(){(undefined==arguments[1]||arguments[1]!==!1)&&d.clear_errors();var b=0;for(index in i){var c=i[index],e=c.element,f={id:e.attr("id"),name:e.attr("name"),type:v(e)};f.name=f.name.replace(/\[[^\[\]]*\]$/,"");var g=f["type"]=="radio"||f["type"]=="checkbox"?f.name:f.id;if(undefined!=arguments[0]&&arguments[0].get(0)!=e.get(0))continue;if(undefined!=c.message&&undefined==k[g]){e.hasClass("myzebra-style-hidden")&&(e=e.parent().children("a").eq(0)),e.hasClass("myzebra-select")&&a("#dk_container_"+e.attr("id")).length&&(e=a("#dk_container_"+e.attr("id"))),e.css("display")!="none"&&(undefined==arguments[1]||arguments[1]!==!1)&&!(d.settings.validate_all&&b>0)&&e.focus();var h=a.extend(e.offset());h=a.extend(h,{right:Math.floor(h.left+e.width())});var j=jQuery("<div/>",{"class":"MyZebra_Form_error_message",id:"MyZebra_Form_error_message_"+g,css:{opacity:0}}),l=jQuery("<div/>",{"class":"myzebra-message"+(d.settings.close_tips?"":" myzebra-noclose"),css:{_width:"auto"}}).html(c.message).appendTo(j);if(d.settings.close_tips)var m=jQuery("<a/>",{href:"javascript:void(0)","class":"myzebra-close"+(a.browser.msie&&a.browser.version.match(/^6/)?"-ie6":"")}).html("x").appendTo(l).unbind("click focus").bind({click:function(b){b.preventDefault(),d.hide_error(a(this).closest("div.MyZebra_Form_error_message").attr("id").replace(/^MyZebra\_Form\_error\_message\_/,""),!0)},focus:function(){a(this).blur()}});var n=jQuery("<div/>",{"class":"myzebra-arrow"}).appendTo(j);a("body").append(j);var o={x:j.outerWidth(),y:j.outerHeight()},p={x:n.outerWidth(),y:n.outerHeight()},q=(d.settings.tips_position=="left"?h.left:h.right)-o.x/2;n.css("left",o.x/2-p.x/2-1);if(f["type"]=="radio"||f["type"]=="checkbox")q=h.right-o.x/2-e.outerWidth()/2+1;q<0&&(q=2),j.css("left",q),o={x:j.outerWidth(),y:j.outerHeight()};var r=h.top-o.y+p.y/2-1;r<0&&(r=2),j.css({left:q+"px",top:r+"px",height:o.y-p.y/2+"px"}),k[g]=j,t(j),j.animate({opacity:.9},250),++b==1&&d.settings.scroll_to_error&&(undefined==arguments[1]||arguments[1]!==!1)&&a("html, body").animate({scrollTop:Math.max(parseInt(j.css("top"),10)+parseInt(j.css("height"),10)/2-a(window).height()/2,0)},0);if(!d.settings.validate_all)break}}},d.submit=function(){undefined!=d.settings.error_messages?n.trigger("submit"):o.submit()},d.validate_control=function(b){var c={id:b.attr("id"),type:v(b)},e=!0,f=i[c.id];if(undefined!=f&&(b.hasClass("myzebra-style-hidden")||b.hasClass("myzebra-select")||b.attr("disabled")!="disabled"&&b.css("display")!="none"&&b.css("visibility")!="hidden"||b.data("file_info"))){var g=null,h=null;delete f.message;for(var k in f.rules){if(!e)break;switch(k){case"alphabet":switch(c.type){case"password":case"text":case"textarea":var l=new RegExp("^[a-z"+q(f.rules[k][0]).replace(/\s/,"\\s")+"]+$","ig");a.trim(b.val())!=""&&!l.test(b.val())&&(e=!1)}break;case"alphanumeric":switch(c.type){case"password":case"text":case"textarea":var l=new RegExp("^[a-z0-9"+q(f.rules[k][0]).replace(/\s/,"\\s")+"]+$","ig");a.trim(b.val())!=""&&!l.test(b.val())&&(e=!1)}break;case"compare":switch(c.type){case"password":case"text":case"textarea":if(!a("#"+f.rules[k][0])||b.val()!=a("#"+f["rules"][k][0]).val())e=!1}break;case"custom":var m=!1;a.each(f.rules[k],function(c,d){if(m)return;d=a.map(d.split(","),function(a){return a.replace(/mark\;/g,",")}),d=a.merge(a.merge([d.shift()],[b.val()]),d);var f=typeof d[0]=="function"?d[0]:typeof window[d[0]]=="function"?window[d[0]]:!1;if(f!==!1)e=f.apply(f,d.slice(1));else throw e=!1,new Error('Function "'+d[0]+"\" doesn't exist!");e||(h=d[0],m=!0)});break;case"date":switch(c.type){case"text":if(a.trim(b.val())!=""){var n=!1,o=b.data("MyZebra_DatePicker").settings.format.replace(/\s/g,""),p=["d","D","j","l","N","S","w","F","m","M","n","Y","y","G","H","g","h","a","A","i","s","U"],r=new Array,t=new Array;o=q(o);for(var u=0;u<p.length;u++)(position=o.indexOf(p[u]))>-1&&r.push({character:p[u],position:position});r.sort(function(a,b){return a.position-b.position}),a.each(r,function(a,b){switch(b.character){case"d":t.push("0[1-9]|[12][0-9]|3[01]");break;case"D":t.push("[a-z]{3}");break;case"j":t.push("[1-9]|[12][0-9]|3[01]");break;case"l":t.push("[a-z]+");break;case"N":t.push("[1-7]");break;case"S":t.push("st|nd|rd|th");break;case"w":t.push("[0-6]");break;case"F":t.push("[a-z]+");break;case"m":t.push("0[1-9]|1[012]+");break;case"M":t.push("[a-z]{3}");break;case"n":t.push("[1-9]|1[012]");break;case"Y":t.push("[0-9]{4}");break;case"y":t.push("[0-9]{2}");break;case"G":case"H":case"g":case"h":t.push("[0-9]{1,2}");break;case"a":case"A":t.push("(am|pm)");break;case"i":case"s":t.push("[012345][0-9]")}});if(t.length>0){r.reverse(),a.each(r,function(a,b){o=o.replace(b.character,"("+t[t.length-a-1]+")")}),t=new RegExp("^"+o+"$","ig");if(segments=t.exec(b.val().replace(/\s/g,""))){var w=null,x=null,y=null,z=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],A=["January","February","March","April","May","June","July","August","September","October","November","December"],B=null,C=!0;r.reverse(),a.each(r,function(c,d){if(!C)return!0;switch(d.character){case"m":case"n":x=parseInt(segments[c+1],10);break;case"d":case"j":w=parseInt(segments[c+1],10);break;case"D":case"l":case"F":case"M":d.character=="D"||d.character=="l"?B=b.data("MyZebra_DatePicker").settings.days:B=b.data("MyZebra_DatePicker").settings.months,C=!1,a.each(B,function(a,b){if(C)return!0;if(segments[c+1].toLowerCase()==b.substring(0,d.character=="D"||d.character=="M"?3:b.length).toLowerCase()){switch(d.character){case"D":segments[c+1]=z[a].substring(0,3);break;case"l":segments[c+1]=z[a];break;case"F":segments[c+1]=A[a],x=a+1;break;case"M":segments[c+1]=A[a].substring(0,3),x=a+1}C=!0}});break;case"Y":y=parseInt(segments[c+1],10);break;case"y":y="19"+parseInt(segments[c+1],10)}});if(C){var D=new Date(y,x-1,w);D.getFullYear()==y&&D.getDate()==w&&D.getMonth()==x-1&&(b.data("timestamp",Date.parse(A[x-1]+" "+w+", "+y)),n=!0)}}}n||(e=!1)}}break;case"datecompare":switch(c.type){case"password":case"text":case"textarea":if(undefined!=f["rules"][k][0]&&undefined!=f["rules"][k][1]&&a(f.rules[k][0])&&d.validate_control(a(f.rules[k][0]))===!0&&undefined!=b.data("timestamp"))switch(f.rules[k][1]){case">":e=b.data("timestamp")>a("#"+f.rules[k][0]).data("timestamp");break;case">=":e=b.data("timestamp")>=a("#"+f.rules[k][0]).data("timestamp");break;case"<":e=b.data("timestamp")<a("#"+f.rules[k][0]).data("timestamp");break;case"<=":e=b.data("timestamp")<=a("#"+f.rules[k][0]).data("timestamp")}else e=!1}break;case"digits":switch(c.type){case"password":case"text":case"textarea":var l=new RegExp("^[0-9"+q(f.rules[k][0]).replace(/\s/,"\\s")+"]+$","ig");a.trim(b.val())!=""&&!l.test(b.val())&&(e=!1)}break;case"email":switch(c.type){case"password":case"text":case"textarea":a.trim(b.val())!=""&&null==b.val().match(/^([a-zA-Z0-9_\-\+\~\^\{\}]+[\.]?)+@{1}([a-zA-Z0-9_\-\+\~\^\{\}]+[\.]?)+\.[A-Za-z0-9]{2,}$/)&&(e=!1)}break;case"emails":switch(c.type){case"password":case"text":case"textarea":var E=b.val().split(",");E.each(function(b){a.trim(b)!=""&&null==a.trim(b).match(/^([a-zA-Z0-9_\-\+\~\^\{\}]+[\.]?)+@{1}([a-zA-Z0-9_\-\+\~\^\{\}]+[\.]?)+\.[A-Za-z0-9]{2,}$/)&&(e=!1)})}break;case"filesize":switch(c.type){case"file":var F=b.data("file_info");F&&(undefined==F[2]||undefined==F[3]||F[2]!=0||parseInt(F[3],10)>parseInt(f.rules[k][0],10))&&(e=!1)}break;case"filetype":switch(c.type){case"file":var F=b.data("file_info");if(F){undefined==d.mimes&&a.ajax({cache:!1,url:decodeURIComponent(d.settings.assets_path)+"mimes.json",async:!1,success:function(a){d.mimes=a},dataType:"json"});var G=a.map(f.rules[k][0].split(","),function(b){return a.trim(b)}),H=[];a.each(d.mimes,function(b,c){(a.isArray(c)&&a.inArray(F[1],c)>-1||!a.isArray(c)&&c==F[1])&&H.push(b)});var I=!1;a.each(H,function(b,c){a.inArray(c,G)>-1&&(I=!0)}),I||(e=!1)}}break;case"float":switch(c.type){case"password":case"text":case"textarea":var l=new RegExp("^[0-9-."+q(f.rules[k][0]).replace(/\s/,"\\s")+"]+$","ig");a.trim(b.val())!=""&&(a.trim(b.val())=="-"||a.trim(b.val())=="."||null!=b.val().match(/\-/g)&&b.val().match(/\-/g).length>1||null!=b.val().match(/\./g)&&b.val().match(/\./g).length>1||b.val().indexOf("-")>0||!l.test(b.val()))&&(e=!1)}break;case"image":switch(c.type){case"file":var F=b.data("file_info");F&&null==F[1].match(/image\/(gif|jpeg|png|pjpeg)/i)&&(e=!1)}break;case"image_max_width":switch(c.type){case"file":var F=b.data("file_info");F&&null!=F[1].match(/image\/(gif|jpeg|png|pjpeg)/i)&&parseInt(F[4],10)>parseInt(f.rules[k][0],10)&&(e=!1)}break;case"image_max_height":switch(c.type){case"file":var F=b.data("file_info");F&&null!=F[1].match(/image\/(gif|jpeg|png|pjpeg)/i)&&parseInt(F[5],10)>parseInt(f.rules[k][0],10)&&(e=!1)}break;case"length":switch(c.type){case"password":case"text":case"textarea":if(b.val()!=""&&undefined!=f["rules"][k][0]&&b.val().length-s(b)<f.rules[k][0]||undefined!=f["rules"][k][1]&&f.rules[k][1]>0&&b.val().length-s(b)>f.rules[k][1])e=!1}break;case"number":switch(c.type){case"password":case"text":case"textarea":var l=new RegExp("^[0-9-"+q(f.rules[k][0]).replace(/\s/,"\\s")+"]+$","ig");a.trim(b.val())!=""&&(a.trim(b.val())=="-"||null!=b.val().match(/\-/g)&&b.val().match(/\-/g).length>1||b.val().indexOf("-")>0||!l.test(b.val()))&&(e=!1)}break;case"regexp":switch(c.type){case"password":case"text":case"textarea":var l=new RegExp(f.rules[k][0],"g");a.trim(b.val())!=""&&null==l.exec(b.val())&&(e=!1)}break;case"url":switch(c.type){case"text":var l=new RegExp(/^(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|$!:,.;]*[A-Z0-9+&@#\/%=~_|$]$/gi);a.trim(b.val())!=""&&null==l.exec(b.val())&&(e=!1)}break;case"required":switch(c.type){case"checkbox":case"radio":var J=!1;j[c.id].each(function(){this.checked&&!this.disabled&&(J=!0)}),J||(e=!1);break;case"file":case"password":case"text":case"textarea":a.trim(b.val())==""&&(e=!1);break;case"select-one":if(b.hasClass("myzebra-time")&&b.get(0).selectedIndex==0)c.id=c.id.replace(/\_(hours|minutes|seconds|ampm)$/,""),e=!1;else if(b.hasClass("myzebra-other")&&b.val()=="other"&&(!a("#"+c.id+"_other").length||a.trim(a("#"+c["id"]+"_other").val())=="")||b.val()==""||b.find("option:selected").attr("disabled"))e=!1;break;case"select-multiple":b.get(0).selectedIndex==-1&&(e=!1)}break;case"upload":switch(c.type){case"file":var F=b.data("file_info");typeof f["rules"].required!="undefined"&&(!F||!F[2]||F[2]!=0)&&(e=!1)}}e||(g=k,f.message=d.settings.error_messages[c.id][k=="custom"?"custom_"+h:g],f.value=b.val())}}return e?!0:g},d.validate=function(){var a=null,c=null,e=!0;for(index in i){if(!e&&!d.settings.validate_all)break;b=i[index].element,c=b.attr("id"),(rule_not_passed=d.validate_control(b))!==!0&&(e=!1)}return e&&undefined!=d.settings.onValid?d.settings.onValid():e};var p=function(){a.each(l,function(){var b=a(this),c=b.data("MyZebra_Form_Placeholder");b.val()==""&&!b.is(":focus")?c.css("display","block"):c.css("display","none")})},q=function(a){return a.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},r=function(a){if(a.selectionStart!=null)return a.selectionStart;var b=document.selection.createRange(),c=b.duplicate();if(a.type=="text")return 0-c.moveStart("character",-1e5);var d=a.value,e=d.length;return c.moveToElementText(a),c.setEndPoint("StartToStart",b),e-c.text.length},s=function(a){var b=a.val(),c=b.length,d=b.replace(/(\r\n|\r|\n)/g,"\r\n").length;return d-c},t=function(b){if(a.browser.msie&&a.browser.version.match(/^6/)&&!b.data("shim")){var c=b.offset(),d=parseInt(b.css("zIndex"),10)-1,e=jQuery("<iframe>",{src:'javascript:document.write("")',scrolling:"no",frameborder:0,allowTransparency:"true","class":"MyZebra_Form_error_iFrameShim",css:{zIndex:d,position:"absolute",top:c.top,left:c.left,width:b.outerWidth(),height:b.outerHeight(),filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)",display:"block"}});a("body").append(e),b.data("shim",e)}},u=function(b){var c=a("#"+b.attr("id")+"_other");b.val()=="other"?c.css("display","block"):c.css("display","none")},v=function(a){var b=["button","input:checkbox","input:file","input:password","input:radio","input:submit","input:text","select","textarea"];for(index in b)if(a.is(b[index]))return b[index]=="select"?a.attr("multiple")?"select-multiple":"select-one":b[index].replace(/input\:/,"")};d.init()},a.fn.MyZebra_Form=function(b){return this.each(function(){var c=new a.MyZebra_Form(this,b);a(this).data("MyZebra_Form",c)})}})(jQuery)